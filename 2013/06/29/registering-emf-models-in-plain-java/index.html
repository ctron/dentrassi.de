<!doctype html><html lang=en-US><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><link as=font crossorigin href=https://dentrassi.de/files/jost-latin-400-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://dentrassi.de/files/jost-latin-500-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://dentrassi.de/files/jost-latin-700-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://dentrassi.de/files/noto-sans-latin-400-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://dentrassi.de/files/noto-sans-latin-500-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://dentrassi.de/files/noto-sans-latin-700-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://dentrassi.de/files/source-code-pro-latin-400-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://dentrassi.de/files/source-code-pro-latin-500-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://dentrassi.de/files/source-code-pro-latin-700-normal.woff2 rel=preload type=font/woff2><link href="https://dentrassi.de/main.css?h=12d0957c36c254464d7f" rel=stylesheet><script>var _paq=window._paq=window._paq||[];_paq.push(['trackPageView']);_paq.push(['enableLinkTracking']);(function(){var a="https://logs.dentrassi.de/";_paq.push(['setTrackerUrl',a+ 'matomo.php']);_paq.push(['setSiteId','1']);var b=document,c=b.createElement('script'),d=b.getElementsByTagName('script')[0];c.async=true;c.src=a+ 'matomo.js';d.parentNode.insertBefore(c,d)})()</script><meta content="Using Eclipse EMF/Ecore models inside the Eclipse Platform is quite easy. Loading an XML/XMI serialized model file is only a matter of some lines of code. The most interesting thing about this is that the whole Eclipse platform can handle the registration of models and model factories for you. So instead of knowing what model type you are loading, it will be detected and the right model factory will be used for loading and creating your model instance. Even better is the fact that also derived model objects can be loaded that way.
" name=description><meta content=article property=og:type><meta content="ctron's blog" property=og:site_name><meta content="Registering EMF models in plain java" property=og:title><meta content=https://dentrassi.de/2013/06/29/registering-emf-models-in-plain-java property=og:url><meta content="Using Eclipse EMF/Ecore models inside the Eclipse Platform is quite easy. Loading an XML/XMI serialized model file is only a matter of some lines of code. The most interesting thing about this is that the whole Eclipse platform can handle the registration of models and model factories for you. So instead of knowing what model type you are loading, it will be detected and the right model factory will be used for loading and creating your model instance. Even better is the fact that also derived model objects can be loaded that way.
" property=og:description><meta content="Jens Reimann" property=og:author_name><meta content=https://dentrassi.de property=og:author_url><meta content=summary name=twitter:card><meta content=@ctron name=twitter:site><meta content="Registering EMF models in plain java" name=twitter:title><meta content="Using Eclipse EMF/Ecore models inside the Eclipse Platform is quite easy. Loading an XML/XMI serialized model file is only a matter of some lines of code. The most interesting thing about this is that the whole Eclipse platform can handle the registration of models and model factories for you. So instead of knowing what model type you are loading, it will be detected and the right model factory will be used for loading and creating your model instance. Even better is the fact that also derived model objects can be loaded that way.
" name=twitter:description><title>ctron's blog</title><link href=https://dentrassi.de/rss.xml rel=alternate title=RSS type=application/rss+xml><body data-bs-spy=scroll data-bs-target=#toc tabindex=0><nav class="navbar fixed-top navbar-expand-lg bg-body-tertiary"><div class=container><a class=navbar-brand href=https://dentrassi.de>ctron's blog</a><form class="de-c-search-form d-none d-lg-flex ms-auto me-3"><input placeholder="Search docs" aria-label=Search autocomplete=off class=form-control id=searchInput type=search><div class="shadow bg-white rounded" id=suggestions></div></form><div class="d-none d-md-flex ms-auto ms-lg-0 me-4 me-lg-0"><div class=row><div class=col><a title="Link to my GitHub profile" class=link-secondary href=https://github.com/ctron target=_blank> <svg class="feather feather-github" viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg> </a></div><div class=col><a title="Link to my Mastodon profile" class=link-secondary href=https://mastodon.dentrassi.de/@ctron rel=me target=_blank> <svg viewbox="0 0 24 24" fill=currentColor height=24 stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M23.193 7.879c0-5.206-3.411-6.732-3.411-6.732C18.062.357 15.108.025 12.041 0h-.076c-3.068.025-6.02.357-7.74 1.147 0 0-3.411 1.526-3.411 6.732 0 1.192-.023 2.618.015 4.129.124 5.092.934 10.109 5.641 11.355 2.17.574 4.034.695 5.535.612 2.722-.15 4.25-.972 4.25-.972l-.09-1.975s-1.945.613-4.129.539c-2.165-.074-4.449-.233-4.799-2.891a5.499 5.499 0 0 1-.048-.745s2.125.52 4.817.643c1.646.075 3.19-.097 4.758-.283 3.007-.359 5.625-2.212 5.954-3.905.517-2.665.475-6.507.475-6.507zm-4.024 6.709h-2.497V8.469c0-1.29-.543-1.944-1.628-1.944-1.2 0-1.802.776-1.802 2.312v3.349h-2.483v-3.35c0-1.536-.602-2.312-1.802-2.312-1.085 0-1.628.655-1.628 1.944v6.119H4.832V8.284c0-1.289.328-2.313.987-3.07.68-.758 1.569-1.146 2.674-1.146 1.278 0 2.246.491 2.886 1.474L12 6.585l.622-1.043c.64-.983 1.608-1.474 2.886-1.474 1.104 0 1.994.388 2.674 1.146.658.757.986 1.781.986 3.07v6.304z"/></svg> </a></div><div class=col><a title="Link to my matrix address" class=link-secondary href=https://matrix.to/#%2F%40ctron%3Adentrassi.de target=_blank> <svg class="feather feather-message-square" viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg> </a></div></div></div><button aria-label="Toggle navigation" aria-controls=rightSidebox aria-expanded=false class=navbar-toggler data-bs-target=#rightSidebox data-bs-toggle=collapse type=button><span class=navbar-toggler-icon></span></button></div></nav><div class="de-layout container"><div class="row d-flex align-items-start"><aside class="col-lg-2 order-last order-lg-0 sticky-lg-top mt-4 mt-lg-5"><div class="de-sidebox de-m-left"><div class=mb-4><h2>More</h2><ul class=list-unstyled><li><a class=link-body-emphasis href=/pages/about/>About</a><li><a class=link-body-emphasis href=/pages/pgp-key/>PGP Key</a><li><a class=link-body-emphasis href=/pages/attic/>Attic</a></ul></div><div class=mb-4><h2>Projects</h2><ul class=list-unstyled><li><a class=link-body-emphasis href=/projects/patternfly-yew/>PatternFly Yew</a><li><a class=link-body-emphasis href=/projects/yew-oauth2/>Yew OAuth2</a><li><a class=link-body-emphasis href=/projects/rpm-builder/>Maven RPM Builder</a><li><a class=link-body-emphasis href=/projects/drogue-iot/>Drogue IoT</a><li><a class=link-body-emphasis href=/projects/openshift-update-graph/>OpenShift Update Graph</a><li><a class=link-body-emphasis href=/projects/ecliipse-iot-packages/>Eclipse IoT Packages</a></ul></div></div></aside><main class="col-12 col-lg-7 px-lg-5 mt-3 mt-lg-4"><article class=de-article itemscope itemtype=http://schema.org/BlogPosting><div><section class=de-article__header><h1 itemprop="name headline">Registering EMF models in plain java</h1><div><ul class="de-c-post-meta list-inline text-muted"><li class=list-inline-item><span>4 minute read</span> <meta content=784 itemprop=wordCount> <span class=d-none itemprop=author itemscope itemtype=https://schema.org/Person> <a href=https://dentrassi.de itemprop=url> <span itemprop=name>Jens Reimann</span> </a> </span><li class=list-inline-item><span content=2013-06-29 itemprop=datePublished>29 June 2013</span></ul></div></section><hr><section class=de-article__body itemprop=articleBody><p>Using <a href="http://www.eclipse.org/modeling/emf/?project=emf#emf" rel="noopener nofollow noreferrer" title="Eclipse EMF/ECore" target=_blank>Eclipse EMF/Ecore</a> models inside the Eclipse Platform is quite easy. Loading an XML/XMI serialized model file is only a matter of some lines of code. The most interesting thing about this is that the whole Eclipse platform can handle the registration of models and model factories for you. So instead of knowing what model type you are loading, it will be detected and the right model factory will be used for loading and creating your model instance. Even better is the fact that also derived model objects can be loaded that way.</p><span id=continue-reading></span><p>Just image you are writing a model A and extend object in the model B. So you can create a model instance which contains objects from model A and B and just serialize it to XML. Loading it back will of course give you model objects of type A and B. Although initially only model A existed and B was an extension using derivation. For this to work the resource mechanism of EMF must need to know which namespace is handled by which resource package and factory. If you are running inside an Eclipse Platform this is easily done using the extension mechanism. And the “genmodel” file and generator will automatically create the correct code and “plugin.xml” for this setup.<p>The problems start when you are outside the Eclipse Platform and running in a plain Java application. The default way to go is by registering all EMF models somewhere before loading the serialized models:<pre class=language-java data-lang=java style=background:#fafafa;color:#383a42><code class=language-java data-lang=java><span style=color:#a626a4>public</span><span> void </span><span style=color:#e45649>setup </span><span>() {
</span><span>  </span><span style=color:#c18401>MyModelPackage</span><span>.eINSTANCE.</span><span style=color:#e45649>eClass</span><span>();
</span><span>}
</span></code></pre><p>While this seems plain simple for many scenarious, it still brings in the need to register you model packages manually at some point. If you only have one model you may be fine with this. But imagine you have a large number of models or you want to allow derived models:<pre class=language-java data-lang=java style=background:#fafafa;color:#383a42><code class=language-java data-lang=java><span style=color:#a626a4>public</span><span> void </span><span style=color:#e45649>setup </span><span>() {
</span><span>  </span><span style=color:#c18401>MyModelPackage</span><span>.eINSTANCE.</span><span style=color:#e45649>eClass</span><span>();
</span><span>  </span><span style=color:#c18401>MyExtensionModelPackage</span><span>.eINSTANCE.</span><span style=color:#e45649>eClass</span><span>();
</span><span>}
</span></code></pre><p>The problem here is that you must know in advance what extension are there. If you want to allow you application to be extended in some way you did not define in the beginning, you are out of luck using the this simple way. The Eclipse Extension manager would handle this for you, but this is not an option for most plain Java applications.<p>But since Java 1.6 there is a way similar to the Eclipse extension points which can be used to achieve what the extension manager would do with EMF models. The <a rel="noopener nofollow noreferrer" href=http://docs.oracle.com/javase/6/docs/api/java/util/ServiceLoader.html target=_blank title=ServiceLoader>ServiceLoader</a> mechanism allows one to find implementations for a provided interface in the current classpath. Although this has some limitation when the classpath contains “http” references, but on the local filesystem it works without any problems.<p>We simply define an interface “ModelInitializer” which will be the reference to all models that we want to load at a time:<pre class=language-java data-lang=java style=background:#fafafa;color:#383a42><code class=language-java data-lang=java><span style=color:#a626a4>package </span><span>de.dentrassi.models;
</span><span>
</span><span style=color:#a626a4>public interface </span><span style=color:#c18401>ModelInitializer </span><span>{
</span><span>  </span><span style=color:#a626a4>void </span><span style=color:#0184bc>initializeModel </span><span>();
</span><span>}
</span></code></pre><p>Next we add an implementation of this in each jar file which contains a model, or at least which should be in charge if registering the model:<pre class=language-java data-lang=java style=background:#fafafa;color:#383a42><code class=language-java data-lang=java><span style=color:#a626a4>package </span><span>de.dentrassi.sample;
</span><span>
</span><span style=color:#a626a4>public class </span><span style=color:#c18401>ModelInitializerImpl </span><span style=color:#a626a4>implements </span><span style=color:#c18401>ModelInitializer </span><span>{
</span><span>  </span><span style=color:#a626a4>public void </span><span style=color:#0184bc>initializeModel </span><span>() {
</span><span>    </span><span style=color:#c18401>MyModelPackage</span><span>.eINSTANCE.</span><span style=color:#e45649>eClass</span><span>();
</span><span>  }
</span><span>}
</span></code></pre><p>Of course, we do need to do this also for the other model packages. It can be done in the same implementation or in a different one, depending on what you prefer.<p>Now the important step is to add a “service file” to the JAR file. So each “ModelInitializer” instance must be declared as a “Service” in order for the “ServiceLoader” to find it. In order to do this we need to add a file named “de.dentrassi.models.ModelInitializer” (or whatever you named your interface) and put in the class name of the implemenation. The file has to be placed in the “META-INF/services” directory of your JAR file:<pre class=language-java data-lang=java style=background:#fafafa;color:#383a42><code class=language-java data-lang=java><span>de.dentrassi.sample.</span><span style=color:#c18401>ModelInitializerImpl
</span></code></pre><p>Again, this has to be done for all implementations.<p>So when we want to initialize all model packages we can use the ServiceLoader in order to find all that are declared:<pre class=language-java data-lang=java style=background:#fafafa;color:#383a42><code class=language-java data-lang=java><span style=color:#a626a4>import </span><span>de.dentrassi.models.</span><span style=color:#c18401>ModelInitializer</span><span>;
</span><span style=color:#a626a4>import </span><span>java.util.</span><span style=color:#c18401>ServiceLoader</span><span>;
</span><span>
</span><span style=color:#a626a4>public</span><span> void </span><span style=color:#e45649>initializeAll </span><span>() {
</span><span>  </span><span style=color:#c18401>ServiceLoader</span><span><</span><span style=color:#c18401>ModelInitializer</span><span>> serviceLoader </span><span style=color:#a626a4>= </span><span style=color:#c18401>ServiceLoader</span><span>.</span><span style=color:#e45649>load</span><span>(</span><span style=color:#c18401>ModelInitializer</span><span>.</span><span style=color:#e45649>class</span><span>);
</span><span>  </span><span style=color:#a626a4>for </span><span>(</span><span style=color:#c18401>ModelInitializer</span><span> service </span><span style=color:#a626a4>:</span><span> serviceLoader) {
</span><span>         service.</span><span style=color:#e45649>initializeModel </span><span>();
</span><span>  }
</span><span>}
</span><span>
</span></code></pre><p>That’s it! What happens is that all declared instances if “ModelInitializer” will be located and their “initializeModel” method will be called, which then will initialize the EMF model and register it with the central registry. Also it is no problem if the initialization is run multiple times since the process of initialization will be correctly handled by EMF models in this case.<p>The layout of multiple JAR files would be like this:<pre style=background:#fafafa;color:#383a42><code><span>fileModel.jar
</span><span>  de/
</span><span>    dentrassi/
</span><span>      sample/
</span><span>        ModelInitializerImpl.class
</span><span>  META-INF/
</span><span>    services/
</span><span>      de.dentrassi.models.ModelInitializer -> Contains: "de.dentrassi.sample.ModelInitializerImpl"
</span><span>fileModelExtension.jar
</span><span>  de/
</span><span>    dentrassi/
</span><span>      ext/
</span><span>        ModelInitializerImpl.class
</span><span>  META-INF/
</span><span>    services/
</span><span>      de.dentrassi.models.ModelInitializer -> Contains: "de.dentrassi.ext.ModelInitializerImpl"
</span></code></pre></section></div></article></main><aside class="col-lg-3 order-first order-lg-0 sticky-top mt-lg-5 de-m-collapsible"><div class="de-sidebox de-m-right collapse d-lg-block" id=rightSidebox><div class="d-flex d-md-none pb-3"><div class=row><div class=col><a title="Link to my GitHub profile" class=link-secondary href=https://github.com/ctron target=_blank> <svg class="feather feather-github" viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg> </a></div><div class=col><a title="Link to my Mastodon profile" class=link-secondary href=https://mastodon.dentrassi.de/@ctron rel=me target=_blank> <svg viewbox="0 0 24 24" fill=currentColor height=24 stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M23.193 7.879c0-5.206-3.411-6.732-3.411-6.732C18.062.357 15.108.025 12.041 0h-.076c-3.068.025-6.02.357-7.74 1.147 0 0-3.411 1.526-3.411 6.732 0 1.192-.023 2.618.015 4.129.124 5.092.934 10.109 5.641 11.355 2.17.574 4.034.695 5.535.612 2.722-.15 4.25-.972 4.25-.972l-.09-1.975s-1.945.613-4.129.539c-2.165-.074-4.449-.233-4.799-2.891a5.499 5.499 0 0 1-.048-.745s2.125.52 4.817.643c1.646.075 3.19-.097 4.758-.283 3.007-.359 5.625-2.212 5.954-3.905.517-2.665.475-6.507.475-6.507zm-4.024 6.709h-2.497V8.469c0-1.29-.543-1.944-1.628-1.944-1.2 0-1.802.776-1.802 2.312v3.349h-2.483v-3.35c0-1.536-.602-2.312-1.802-2.312-1.085 0-1.628.655-1.628 1.944v6.119H4.832V8.284c0-1.289.328-2.313.987-3.07.68-.758 1.569-1.146 2.674-1.146 1.278 0 2.246.491 2.886 1.474L12 6.585l.622-1.043c.64-.983 1.608-1.474 2.886-1.474 1.104 0 1.994.388 2.674 1.146.658.757.986 1.781.986 3.07v6.304z"/></svg> </a></div><div class=col><a title="Link to my matrix address" class=link-secondary href=https://matrix.to/#%2F%40ctron%3Adentrassi.de target=_blank> <svg class="feather feather-message-square" viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg> </a></div></div></div><div class="d-lg-block d-none"><div class="de-c-recent-posts mb-2"><h2 class=d-flex><span>Recent Posts</span> <span class=de-c-title__action> <a href=https://dentrassi.de/archive>Archive</a> </span></h2><ul class=list-unstyled><li><a title="A fresh start" class=link-body-emphasis href=/2023/10/03/a-fresh-start/>A fresh start</a><li><a title="Using Ingress on OpenShift backed by Routes" class=link-body-emphasis href=/2021/05/21/using-ingress-on-openshift-backed-by-routes/>Using Ingress on OpenShift backed by Routes</a><li><a title="Recovering from an expired OpenShift certificate" class=link-body-emphasis href=/2021/01/18/recovering-from-an-expired-openshift-certificate/>Recovering from an expired OpenShift certificate</a><li><a title="A Rusty frontend: Patternfly & Yew" class=link-body-emphasis href=/2021/01/08/rusty-frontend-patternfly-yew/>A Rusty frontend: Patternfly & Yew</a><li><a title="OpenShift Update Graph Visualizer, lessons learned" class=link-body-emphasis href=/2020/08/02/openshift-update-graph-visualizer-lessons-learned/>OpenShift Update Graph Visualizer, lessons learned</a></ul></div></div></div></aside></div></div><footer class="bg-body-tertiary py-5 mt-lg-5"><div class="container text-body-secondary"><div class=row><div class="col-12 col-lg mb-2">© ctron's blog – All rights reserved</div><div class="col-12 col-lg"><ul class="list-unstyled mb-0"><li><a class=link-secondary href=https://dentrassi.de/legal/disclaimer/>Disclaimer</a><li><a class=link-secondary href=https://dentrassi.de/legal/impress/>Impressum / Impress</a><li><a class=link-secondary href=https://dentrassi.de/legal/privacy/>Datenschutzerklärung / Privacy Policy</a></ul></div><div class="col-12 col-lg"><a class=link-secondary href=https://dentrassi.de/legal/contact/>Contact</a></div></div></div></footer><script src="https://dentrassi.de/js/bootstrap.bundle.min.js?h=82f64f62bb03c1bc1824"></script><script src="https://dentrassi.de/elasticlunr.min.js?h=4f648b9e42abdef9c436" defer></script><script src="https://dentrassi.de/js/search.js?h=ed51a29cb343a0c8a535" defer></script><script>window.searchIndexLocation="https://dentrassi.de/search_index.en.json?h=3c170c64f7d0522edd33"</script>