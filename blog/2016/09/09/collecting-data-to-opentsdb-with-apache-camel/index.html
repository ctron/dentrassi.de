<!doctype html><html lang=en-US><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><link as=font crossorigin href=dentrassi.de/files/jost-latin-400-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=dentrassi.de/files/jost-latin-500-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=dentrassi.de/files/jost-latin-700-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=dentrassi.de/files/noto-sans-latin-400-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=dentrassi.de/files/noto-sans-latin-500-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=dentrassi.de/files/noto-sans-latin-700-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=dentrassi.de/files/source-code-pro-latin-400-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=dentrassi.de/files/source-code-pro-latin-500-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=dentrassi.de/files/source-code-pro-latin-700-normal.woff2 rel=preload type=font/woff2><link href=dentrassi.de/main.css rel=stylesheet><title>ctron's blog</title><link href=dentrassi.de/atom.xml rel=alternate title=RSS type=application/rss+xml><body data-bs-spy=scroll data-bs-target=#toc tabindex=0><nav class="navbar fixed-top navbar-expand-lg bg-body-tertiary"><div class=container><a class=navbar-brand href=dentrassi.de>ctron's blog</a><div class="d-flex ms-auto me-4 me-lg-0"><div class=row><div class=col><a title="Link to my GitHub profile" class=link-secondary href=https://github.com/ctron target=_blank> <svg class="feather feather-github" viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg> </a></div><div class=col><a title="Link to my Mastodon profile" class=link-secondary href=https://mastodon.dentrassi.de/@ctron target=_blank> <svg viewbox="0 0 24 24" fill=currentColor height=24 stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M23.193 7.879c0-5.206-3.411-6.732-3.411-6.732C18.062.357 15.108.025 12.041 0h-.076c-3.068.025-6.02.357-7.74 1.147 0 0-3.411 1.526-3.411 6.732 0 1.192-.023 2.618.015 4.129.124 5.092.934 10.109 5.641 11.355 2.17.574 4.034.695 5.535.612 2.722-.15 4.25-.972 4.25-.972l-.09-1.975s-1.945.613-4.129.539c-2.165-.074-4.449-.233-4.799-2.891a5.499 5.499 0 0 1-.048-.745s2.125.52 4.817.643c1.646.075 3.19-.097 4.758-.283 3.007-.359 5.625-2.212 5.954-3.905.517-2.665.475-6.507.475-6.507zm-4.024 6.709h-2.497V8.469c0-1.29-.543-1.944-1.628-1.944-1.2 0-1.802.776-1.802 2.312v3.349h-2.483v-3.35c0-1.536-.602-2.312-1.802-2.312-1.085 0-1.628.655-1.628 1.944v6.119H4.832V8.284c0-1.289.328-2.313.987-3.07.68-.758 1.569-1.146 2.674-1.146 1.278 0 2.246.491 2.886 1.474L12 6.585l.622-1.043c.64-.983 1.608-1.474 2.886-1.474 1.104 0 1.994.388 2.674 1.146.658.757.986 1.781.986 3.07v6.304z"/></svg> </a></div><div class=col><a title="Link to my matrix address" class=link-secondary href=https://matrix.to/#%2F%40ctron%3Adentrassi.de target=_blank> <svg class="feather feather-message-square" viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg> </a></div></div></div><button aria-label="Toggle navigation" aria-controls=rightSidebox aria-expanded=false class=navbar-toggler data-bs-target=#rightSidebox data-bs-toggle=collapse type=button><span class=navbar-toggler-icon></span></button></div></nav><div class="de-layout container"><div class="row d-flex align-items-start"><aside class="col-lg-2 order-last order-lg-0 sticky-lg-top mt-4 mt-lg-5"><div class="de-sidebox de-m-left"><div class=mb-4><h2>More</h2><ul class=list-unstyled><li><a class=link-body-emphasis href=/pages/about/>About</a><li><a class=link-body-emphasis href=/pages/pgp-key/>PGP Key</a><li><a class=link-body-emphasis href=/pages/attic/>Attic</a></ul></div><div class=mb-4><h2>Projects</h2><ul class=list-unstyled><li><a class=link-body-emphasis href=/projects/patternfly-yew/>PatternFly Yew</a><li><a class=link-body-emphasis href=/projects/yew-oauth2/>Yew OAuth2</a><li><a class=link-body-emphasis href=/projects/rpm-builder/>Maven RPM Builder</a><li><a class=link-body-emphasis href=/projects/drogue-iot/>Drogue IoT</a><li><a class=link-body-emphasis href=/projects/openshift-update-graph/>OpenShift Update Graph</a><li><a class=link-body-emphasis href=/projects/ecliipse-iot-packages/>Eclipse IoT Packages</a></ul></div></div></aside><main class="col-12 col-lg-7 px-lg-5 mt-3 mt-lg-4"><article class=de-article itemscope itemtype=http://schema.org/BlogPosting><div><section class=de-article__header><h1 itemprop="name headline">Collecting data to OpenTSDB with Apache Camel</h1><div><ul class="de-c-post-meta list-inline text-muted"><li class=list-inline-item><span>3 minute read</span> <meta content=416 itemprop=wordCount><li class=list-inline-item><span content=2016-09-09 itemprop=datePublished> 9 September 2016</span></ul></div></section><hr><section class=de-article__body itemprop=articleBody><p><a rel="noopener nofollow noreferrer" href=http://opentsdb.net/ target=_blank>OpenTSDB</a> is an open source, scalable, &LTbuzzword>big data&LT/buzzword> solution for storing time series data. Well, that what the name of the project actually says ;-) In combination with <a rel="noopener nofollow noreferrer" href=http://grafana.org/ target=_blank>Grafana</a> you can pretty easy build a few nice dashboards for visualizing that data. The only question is of course, how do you get your data into that system.</p><span id=continue-reading></span><p>My intention was to provide a simple way to stream metrics into OpenTSDB using <a rel="noopener nofollow noreferrer" href=http://camel.apache.org/ target=_blank>Apache Camel</a>. A quick search did not bring up any existing solutions for pushing data from Apache Camel to OpenTSDB, so I decided to write a small Camel component which can pick up data and send this to OpenTSDB using the HTTP API. Of course having a plain OpenTSDB HTTP Collector API for that would be fine as well. So I did split up the component into three different modules. A generic OpenTSDB collector API, an HTTP implementation of that and finally the Apache Camel component.<p>All components are already available in Maven Central, and although they have the version number 0.0.3, they are working quite well ;-)<pre class=language-xml data-lang=xml style=background:#fafafa;color:#383a42><code class=language-xml data-lang=xml><span><</span><span style=color:#e45649>dependency</span><span>>
</span><span>  <</span><span style=color:#e45649>groupId</span><span>>de.dentrassi.iot&LT/</span><span style=color:#e45649>groupId</span><span>>
</span><span>  <</span><span style=color:#e45649>artifactId</span><span>>de.dentrassi.iot.opentsdb.collector&LT/</span><span style=color:#e45649>artifactId</span><span>>
</span><span>  <</span><span style=color:#e45649>version</span><span>>0.0.3&LT/</span><span style=color:#e45649>version</span><span>>
</span><span>&LT/</span><span style=color:#e45649>dependency</span><span>>
</span><span><</span><span style=color:#e45649>dependency</span><span>>
</span><span>  <</span><span style=color:#e45649>groupId</span><span>>de.dentrassi.iot&LT/</span><span style=color:#e45649>groupId</span><span>>
</span><span>  <</span><span style=color:#e45649>artifactId</span><span>>de.dentrassi.iot.opentsdb.collector.http&LT/</span><span style=color:#e45649>artifactId</span><span>>
</span><span>  <</span><span style=color:#e45649>version</span><span>>0.0.3&LT/</span><span style=color:#e45649>version</span><span>>
</span><span>&LT/</span><span style=color:#e45649>dependency</span><span>>
</span><span><</span><span style=color:#e45649>dependency</span><span>>
</span><span>  <</span><span style=color:#e45649>groupId</span><span>>de.dentrassi.iot&LT/</span><span style=color:#e45649>groupId</span><span>>
</span><span>  <</span><span style=color:#e45649>artifactId</span><span>>de.dentrassi.iot.opentsdb.collector.camel&LT/</span><span style=color:#e45649>artifactId</span><span>>
</span><span>  <</span><span style=color:#e45649>version</span><span>>0.0.3&LT/</span><span style=color:#e45649>version</span><span>>
</span><span>&LT/</span><span style=color:#e45649>dependency</span><span>>
</span></code></pre><p>Dropping those dependencies into your classpath, or into your OSGi container ;-), you can use the following code to easily push data coming from MQTT directly into OpenTSDB:<pre class=language-java data-lang=java style=background:#fafafa;color:#383a42><code class=language-java data-lang=java><span style=color:#c18401>CamelContext</span><span> context </span><span style=color:#a626a4>= new </span><span style=color:#c18401>DefaultCamelContext</span><span>();
</span><span>
</span><span style=color:#a0a1a7>// add routes
</span><span>
</span><span>context.</span><span style=color:#e45649>addRoutes</span><span>(</span><span style=color:#a626a4>new </span><span style=color:#c18401>RouteBuilder</span><span>() </span><span style=color:#c18401>{
</span><span style=color:#c18401>
</span><span style=color:#c18401>@</span><span style=color:#e45649>Override  
</span><span style=color:#a626a4>public void </span><span style=color:#0184bc>configure</span><span style=color:#c18401>() </span><span style=color:#a626a4>throws </span><span style=color:#c18401>Exception {  
</span><span style=color:#c18401> </span><span style=color:#e45649>from</span><span style=color:#c18401>(</span><span style=color:#50a14f>"paho:sensors/test2/temperature?brokerUrl=tcp://iot.eclipse.org"</span><span style=color:#c18401>)  
</span><span style=color:#c18401> .</span><span style=color:#e45649>log</span><span style=color:#c18401>(</span><span style=color:#50a14f>"${body}"</span><span style=color:#c18401>)  
</span><span style=color:#c18401> .</span><span style=color:#e45649>convertBodyTo</span><span style=color:#c18401>(String.</span><span style=color:#e45649>class</span><span style=color:#c18401>).</span><span style=color:#e45649>convertBodyTo</span><span style=color:#c18401>(Float.</span><span style=color:#e45649>class</span><span style=color:#c18401>)  
</span><span style=color:#c18401> .</span><span style=color:#e45649>to</span><span style=color:#c18401>(</span><span style=color:#50a14f>"open-tsdb:http://localhost:4242#test2/value=temp"</span><span style=color:#c18401>);
</span><span style=color:#c18401>
</span><span style=color:#c18401> </span><span style=color:#e45649>from</span><span style=color:#c18401>(</span><span style=color:#50a14f>"paho:tele/devices/TEMP?brokerUrl=tcp://iot.eclipse.org"</span><span style=color:#c18401>)  
</span><span style=color:#c18401> .</span><span style=color:#e45649>log</span><span style=color:#c18401>(</span><span style=color:#50a14f>"${body}"</span><span style=color:#c18401>)  
</span><span style=color:#c18401> .</span><span style=color:#e45649>convertBodyTo</span><span style=color:#c18401>(String.</span><span style=color:#e45649>class</span><span style=color:#c18401>).</span><span style=color:#e45649>convertBodyTo</span><span style=color:#c18401>(Float.</span><span style=color:#e45649>class</span><span style=color:#c18401>)  
</span><span style=color:#c18401> .</span><span style=color:#e45649>to</span><span style=color:#c18401>(</span><span style=color:#50a14f>"open-tsdb:http://localhost:4242#test3/value=temp"</span><span style=color:#c18401>);  
</span><span style=color:#c18401> }  
</span><span style=color:#c18401>}</span><span>);
</span><span>
</span><span style=color:#a0a1a7>// start the context  
</span><span>context.</span><span style=color:#e45649>start</span><span>();  
</span></code></pre><p>You can directly push Floats or Integers into OpenTSDB. The example above shows a “to” component which does directly address a metric. Using <code>#test3/value=temp</code> If you need more tags, then those can be added using <code>#test3/value=temp/foo=bar</code>.<p>But it is also possible to have a generic endpoint and provide the metric information in the actual payload. In this case you have to use the type <code>&LTa href="https://dentrassi.de/iot/de.dentrassi.iot.opentsdb.collector/apidocs/de/dentrassi/iot/opentsdb/collector/Data.html" target="_blank">de.dentrassi.iot.opentsdb.collector.Data&LT/a></code> and fill in the necessary information. It is also possible to publish an array of <code>Data[]</code>.</section></div></article></main><aside class="col-lg-3 order-first order-lg-0 sticky-top mt-lg-5 de-m-collapsible"><div class="de-sidebox de-m-right collapse d-lg-block" id=rightSidebox><div class="d-lg-block d-none"><div class="de-c-recent-posts mb-2"><h2 class=d-flex><span>Recent Posts</span> <span class=de-c-title__action> <a href=dentrassi.de/archive>Archive</a> </span></h2><ul class=list-unstyled><li><a title="Using Ingress on OpenShift backed by Routes" class=link-body-emphasis href=/blog/2021/05/21/using-ingress-on-openshift-backed-by-routes/>Using Ingress on OpenShift backed by Routes</a><li><a title="Recovering from an expired OpenShift certificate" class=link-body-emphasis href=/blog/2021/01/18/recovering-from-an-expired-openshift-certificate/>Recovering from an expired OpenShift certificate</a><li><a title="A Rusty frontend: Patternfly & Yew" class=link-body-emphasis href=/blog/2021/01/08/rusty-frontend-patternfly-yew/>A Rusty frontend: Patternfly & Yew</a><li><a title="OpenShift Update Graph Visualizer, lessons learned" class=link-body-emphasis href=/blog/2020/08/02/openshift-update-graph-visualizer-lessons-learned/>OpenShift Update Graph Visualizer, lessons learned</a><li><a title="Quarkus – Supersonic Subatomic IoT" class=link-body-emphasis href=/blog/2020/06/30/quarkus-supersonic-subatomic-iot/>Quarkus – Supersonic Subatomic IoT</a></ul></div></div></div></aside></div></div><footer class="bg-body-tertiary py-5 mt-lg-5"><div class="container text-body-secondary"><div class=row><div class="col-12 col-lg mb-2">© ctron's blog – All rights reserved</div><div class="col-12 col-lg"><ul class="list-unstyled mb-0"><li><a class=link-secondary href=dentrassi.de/legal/disclaimer/>Disclaimer</a><li><a class=link-secondary href=dentrassi.de/legal/impress/>Impressum / Impress</a><li><a class=link-secondary href=dentrassi.de/legal/privacy/>Datenschutzerklärung / Privacy Policy</a></ul></div><div class="col-12 col-lg"><a class=link-secondary href=dentrassi.de/legal/contact/>Contact</a></div></div></div></footer><script src=dentrassi.de/js/bootstrap.bundle.min.js></script><script defer src=dentrassi.de/elasticlunr.min.js></script><script defer src=dentrassi.de/search_index.en.js></script><script defer src=dentrassi.de/js/search.js></script>