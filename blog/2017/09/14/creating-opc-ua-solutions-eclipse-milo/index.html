<!doctype html><html lang=en-US><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><link as=font crossorigin href=https://staging.dentrassi.de/files/jost-latin-400-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://staging.dentrassi.de/files/jost-latin-500-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://staging.dentrassi.de/files/jost-latin-700-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://staging.dentrassi.de/files/noto-sans-latin-400-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://staging.dentrassi.de/files/noto-sans-latin-500-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://staging.dentrassi.de/files/noto-sans-latin-700-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://staging.dentrassi.de/files/source-code-pro-latin-400-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://staging.dentrassi.de/files/source-code-pro-latin-500-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://staging.dentrassi.de/files/source-code-pro-latin-700-normal.woff2 rel=preload type=font/woff2><link href=https://staging.dentrassi.de/main.css rel=stylesheet><meta content="This article walks you through the first steps of creating an OPC UA solution based on Eclipse Milo. OPC UA, also known as IEC 62541, is an IoT solution for connecting industrial automation systems. Eclipse Milo™ is an open-source Java based implementation.
" name=description><meta content=article property=og:type><meta content="ctron's blog" property=og:site_name><meta content="OPC UA solutions with Eclipse Milo" property=og:title><meta content=https://staging.dentrassi.de/blog/2017/09/14/creating-opc-ua-solutions-eclipse-milo property=og:url><meta content="This article walks you through the first steps of creating an OPC UA solution based on Eclipse Milo. OPC UA, also known as IEC 62541, is an IoT solution for connecting industrial automation systems. Eclipse Milo™ is an open-source Java based implementation.
" property=og:description><meta content="Jens Reimann" property=og:author_name><meta content=https://dentrassi.de property=og:author_url><meta content=summary name=twitter:card><meta content=@ctron name=twitter:site><meta content="OPC UA solutions with Eclipse Milo" name=twitter:title><meta content="This article walks you through the first steps of creating an OPC UA solution based on Eclipse Milo. OPC UA, also known as IEC 62541, is an IoT solution for connecting industrial automation systems. Eclipse Milo™ is an open-source Java based implementation.
" name=twitter:description><meta content=https://staging.dentrassi.de/wp-content/uploads/eclipse-IoT-light.png property=og:image><meta content="https://staging.dentrassi.de/wp-content/uploads/eclipse-IoT-light.png " name=twitter:image><meta content="Eclipse IoT" name=twitter:image:alt><title>ctron's blog</title><link href=https://staging.dentrassi.de/rss.xml rel=alternate title=RSS type=application/rss+xml><body data-bs-spy=scroll data-bs-target=#toc tabindex=0><nav class="navbar fixed-top navbar-expand-lg bg-body-tertiary"><div class=container><a class=navbar-brand href=https://staging.dentrassi.de>ctron's blog</a><form class="de-c-search-form d-none d-lg-flex ms-auto me-3"><input placeholder="Search docs" aria-label=Search autocomplete=off class=form-control id=searchInput type=search><div class="shadow bg-white rounded" id=suggestions></div></form><div class="d-none d-md-flex ms-auto ms-lg-0 me-4 me-lg-0"><div class=row><div class=col><a title="Link to my GitHub profile" class=link-secondary href=https://github.com/ctron target=_blank> <svg class="feather feather-github" viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg> </a></div><div class=col><a title="Link to my Mastodon profile" class=link-secondary href=https://mastodon.dentrassi.de/@ctron target=_blank> <svg viewbox="0 0 24 24" fill=currentColor height=24 stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M23.193 7.879c0-5.206-3.411-6.732-3.411-6.732C18.062.357 15.108.025 12.041 0h-.076c-3.068.025-6.02.357-7.74 1.147 0 0-3.411 1.526-3.411 6.732 0 1.192-.023 2.618.015 4.129.124 5.092.934 10.109 5.641 11.355 2.17.574 4.034.695 5.535.612 2.722-.15 4.25-.972 4.25-.972l-.09-1.975s-1.945.613-4.129.539c-2.165-.074-4.449-.233-4.799-2.891a5.499 5.499 0 0 1-.048-.745s2.125.52 4.817.643c1.646.075 3.19-.097 4.758-.283 3.007-.359 5.625-2.212 5.954-3.905.517-2.665.475-6.507.475-6.507zm-4.024 6.709h-2.497V8.469c0-1.29-.543-1.944-1.628-1.944-1.2 0-1.802.776-1.802 2.312v3.349h-2.483v-3.35c0-1.536-.602-2.312-1.802-2.312-1.085 0-1.628.655-1.628 1.944v6.119H4.832V8.284c0-1.289.328-2.313.987-3.07.68-.758 1.569-1.146 2.674-1.146 1.278 0 2.246.491 2.886 1.474L12 6.585l.622-1.043c.64-.983 1.608-1.474 2.886-1.474 1.104 0 1.994.388 2.674 1.146.658.757.986 1.781.986 3.07v6.304z"/></svg> </a></div><div class=col><a title="Link to my matrix address" class=link-secondary href=https://matrix.to/#%2F%40ctron%3Adentrassi.de target=_blank> <svg class="feather feather-message-square" viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg> </a></div></div></div><button aria-label="Toggle navigation" aria-controls=rightSidebox aria-expanded=false class=navbar-toggler data-bs-target=#rightSidebox data-bs-toggle=collapse type=button><span class=navbar-toggler-icon></span></button></div></nav><div class="de-layout container"><div class="row d-flex align-items-start"><aside class="col-lg-2 order-last order-lg-0 sticky-lg-top mt-4 mt-lg-5"><div class="de-sidebox de-m-left"><div class=mb-4><h2>More</h2><ul class=list-unstyled><li><a class=link-body-emphasis href=/pages/about/>About</a><li><a class=link-body-emphasis href=/pages/pgp-key/>PGP Key</a><li><a class=link-body-emphasis href=/pages/attic/>Attic</a></ul></div><div class=mb-4><h2>Projects</h2><ul class=list-unstyled><li><a class=link-body-emphasis href=/projects/patternfly-yew/>PatternFly Yew</a><li><a class=link-body-emphasis href=/projects/yew-oauth2/>Yew OAuth2</a><li><a class=link-body-emphasis href=/projects/rpm-builder/>Maven RPM Builder</a><li><a class=link-body-emphasis href=/projects/drogue-iot/>Drogue IoT</a><li><a class=link-body-emphasis href=/projects/openshift-update-graph/>OpenShift Update Graph</a><li><a class=link-body-emphasis href=/projects/ecliipse-iot-packages/>Eclipse IoT Packages</a></ul></div></div></aside><main class="col-12 col-lg-7 px-lg-5 mt-3 mt-lg-4"><article class=de-article itemscope itemtype=http://schema.org/BlogPosting><div><section class=de-article__header><h1 itemprop="name headline">OPC UA solutions with Eclipse Milo</h1><div><ul class="de-c-post-meta list-inline text-muted"><li class=list-inline-item><span>11 minute read</span> <meta content=2071 itemprop=wordCount> <span class=d-none itemprop=author itemscope itemtype=https://schema.org/Person> <a href=https://dentrassi.de itemprop=url> <span itemprop=name>Jens Reimann</span> </a> </span><li class=list-inline-item><span content=2017-09-14 itemprop=datePublished>14 September 2017</span></ul></div></section><hr><section class=de-article__body itemprop=articleBody><img alt="Eclipse IoT" class=de-c-article-image itemprop=image src=https://staging.dentrassi.de/wp-content/uploads/eclipse-IoT-light.png><p>This article walks you through the first steps of creating an OPC UA solution based on <a rel="noopener nofollow noreferrer" href=https://eclipse.org/milo target=_blank>Eclipse Milo</a>. OPC UA, also known as IEC 62541, is an IoT solution for connecting industrial automation systems. Eclipse Milo™ is an open-source Java based implementation.</p><span id=continue-reading></span><p><strong>Please note:</strong> In the recent 0.3.x release of Milo, the APIs have been changed. This blog post still uses the old APIs of Milo 0.2.x. However I wrote a new blog post, which covers the <a rel="noopener nofollow noreferrer" href=https://dentrassi.de/2019/07/06/eclipse-milo-0-3-updated-examples/ target=_blank>changes in Milo 0.3.x</a>, compared to this blog post. Since the new post only covers the changes, I encourage you to read on, as everything else in this blog post is still valid.<h3 id=what-is-opc-ua>What is OPC UA?</h3><p>OPC UA is a point-to-point, client/server based communication protocol used in industrial automation scenarios. It offers APIs for telemetry data, command and control, historical data, alarming and event logs. And a bit more.<p>OPC UA is also the successor of OPC DA (AE, HD, …) and puts a lot more emphasis on interoperability than the older, COM/DCOM based, variants. It not only offers a platform neutral communication layer, with security built right into it, but also offers a rich set of interfaces for handling telemetry data, alarms and events, historical data and more. OPC clearly has an industrial background as it is coming from an area of process control, PLC, SCADA like systems. It is also known as IEC 62541.<p>Looking at OPC UA from an MQTT perspective one might ask, why do we need OPC UA? Where MQTT offers a completely undefined topics structure and data types, OPC UA provides a framework for standard and custom datatypes, a defined (hierarchical) namespace and a definition for request/response style communication patterns. Especially the type system, even with simple types, is a real improvement over MQTT’s BLOB approach. With MQTT you never know what is inside your message. It may be a numeric value encoded as string, a JSON encoded object or even a picture of a cat. OPC UA on the other side does offer you a type system which holds the information about the types, in combination with the actual values.<p>OPC UA’s subscription model also provides a really efficient way of transmitting data in a lively manner, but only transmitting data when necessary as defined by client and server. In combination with the binary protocol this can a real resource safer.<h3 id=the-architecture-of-eclipse-milo>The architecture of Eclipse Milo</h3><p>Traditionally OPC UA frameworks are split up in “stack” and “SDK”. The “stack” is the core communication protocol implementation. While the “SDK” is building on top of that, offering a simpler application development model.<p><img alt="Eclipse Milo Components" src=https://dentrassi.de/wp-content/uploads/milo_layers_v1.png><p>Eclipse Milo offers both “stack” and “SDK” for both “client” and “server”. “core” is the common code shared between client and server. This should explain the module structure of Milo when doing a <a rel="noopener nofollow noreferrer" href=https://search.maven.org/#search%7Cga%7C1%7Corg.eclipse.milo target=_blank>search for “org.eclipse.milo” on Maven Central</a>:<pre style=background:#fafafa;color:#383a42><code><span>org.eclipse.milo : stack-core
</span><span>org.eclipse.milo : stack-client
</span><span>org.eclipse.milo : stack-server
</span><span>org.eclipse.milo : sdk-core
</span><span>org.eclipse.milo : sdk-client
</span><span>org.eclipse.milo : sdk-server
</span></code></pre><p>Connecting to an existing OPC UA server would require you to use “sdk-client” only, as all the other modules are transient dependencies of this module. Likewise, creating your own OPC UA server would also only require the “sdk-server” modules.<h3 id=making-contact>Making contact</h3><p>Focusing on the most common use case of OPC, data acquisition and command & control, we will now create a simple client which will read out telemetry data from an existing OPC UA server.<p>The first step is to look up the “endpoint descriptors” from the remote server:<pre class=language-java data-lang=java style=background:#fafafa;color:#383a42><code class=language-java data-lang=java><span style=color:#c18401>EndpointDescription</span><span style=color:#a626a4>[]</span><span> endpoints </span><span style=color:#a626a4>=
</span><span>  </span><span style=color:#c18401>UaTcpStackClient</span><span>.</span><span style=color:#e45649>getEndpoints</span><span>(</span><span style=color:#50a14f>"opc.tcp://localhost:4840"</span><span>)
</span><span>    .</span><span style=color:#e45649>get</span><span>();
</span></code></pre><p>The trailing <code>.get()</code> might have tipped you off that Milo makes use of Java 8 futures and thus easily allows asynchronous programming. However this example will use the synchronous <code>.get()</code> call in order to wait for a result. This will make the tutorial more readable as we will look at the code step by step.<p>Normally the next step would be to pick the “best” endpoint descriptor. However “best” is relative and highly depends on your security and connectivity requirements. So we simply pick the first one:<pre class=language-java data-lang=java style=background:#fafafa;color:#383a42><code class=language-java data-lang=java><span style=color:#c18401>OpcUaClientConfigBuilder</span><span> cfg </span><span style=color:#a626a4>= new </span><span style=color:#c18401>OpcUaClientConfigBuilder</span><span>();
</span><span>cfg.</span><span style=color:#e45649>setEndpoint</span><span>(endpoints[</span><span style=color:#c18401>0</span><span>]);
</span></code></pre><p>Next we will create and connect the OPC client instance based on this configuration. Of course the configuration offers a lot more options. Feel free to explore them all.<pre class=language-java data-lang=java style=background:#fafafa;color:#383a42><code class=language-java data-lang=java><span style=color:#c18401>OpcUaClient</span><span> client </span><span style=color:#a626a4>= new </span><span style=color:#c18401>OpcUaClient</span><span>(cfg.</span><span style=color:#e45649>build</span><span>());
</span><span>client.</span><span style=color:#e45649>connect</span><span>().</span><span style=color:#e45649>get</span><span>();
</span></code></pre><h3 id=node-ids-the-namespace>Node IDs & the namespace</h3><p>OPC UA does identify its elements, objects, folders, items by using “Node IDs”. Each server has multiple namespaces and each namespace has a tree of folders, objects and items. There is a browser API which allows you to browse through this tree, but this is mostly for human interaction. If you know the Node ID of the element you would like to access, then you can simply provide the node ID. Node IDs can be string encoded and might look something like <code>ns=1;i=123</code>. This example would reference to a node in namespace #1 identified by the numeric id “123”. Aside from numeric IDs, there as also string IDs (<code>s=</code>), UUID/GUID IDs (<code>g=</code>) and even a BLOB type (<code>b=</code>).<p>The following examples will assume that a node ID has been parsed into variables like <code>nodeId</code>, which can be done by the following code with Milo:<pre class=language-java data-lang=java style=background:#fafafa;color:#383a42><code class=language-java data-lang=java><span style=color:#c18401>NodeId</span><span> nodeIdNumeric </span><span style=color:#a626a4>= </span><span style=color:#c18401>NodeId</span><span>.</span><span style=color:#e45649>parse</span><span>(</span><span style=color:#50a14f>"ns=1;i=42"</span><span>);
</span><span style=color:#c18401>NodeId</span><span> nodeIdString  </span><span style=color:#a626a4>= </span><span style=color:#c18401>NodeId</span><span>.</span><span style=color:#e45649>parse</span><span>(</span><span style=color:#50a14f>"ns=1;s=foo-bar"</span><span>);
</span></code></pre><p>Of course instances of “NodeId” can also be created using the different constructors. This approach is more performant than using the <code>parse</code> method.<pre class=language-java data-lang=java style=background:#fafafa;color:#383a42><code class=language-java data-lang=java><span style=color:#c18401>NodeId</span><span> nodeIdNumeric </span><span style=color:#a626a4>= new </span><span style=color:#c18401>NodeId</span><span>(</span><span style=color:#c18401>1</span><span>, </span><span style=color:#c18401>42</span><span>);
</span><span style=color:#c18401>NodeId</span><span> nodeIdString  </span><span style=color:#a626a4>= new </span><span style=color:#c18401>NodeId</span><span>(</span><span style=color:#c18401>1</span><span>, </span><span style=color:#50a14f>"foo-bar"</span><span>);
</span></code></pre><p>The main reason behind using Node IDs is, that those can be efficiently encoded when they are transmitted. For example is it possible to lookup an item by a larger string based browse path and then only use the numeric Node ID for further interaction. Node IDs can also be efficiently encoded in the OPC UA binary protocol.<p>Additionally there is a set of “well known” node IDs. For example the root folder always has the node ID <code>ns=0;i=84</code>. So there is no need to look those up, they can be considered constants and be directly used. Milo defines all well known IDs in the <code>Identifiers</code> class.<h3 id=reading-data>Reading data</h3><p>After the connection has been established we will request a single read of a value. Normally OPC UA is used in an event driven manner, but we will start simple by using a single requested read:<pre class=language-java data-lang=java style=background:#fafafa;color:#383a42><code class=language-java data-lang=java><span style=color:#c18401>DataValue</span><span> value </span><span style=color:#a626a4>=
</span><span>  client.</span><span style=color:#e45649>readValue</span><span>(</span><span style=color:#c18401>0</span><span>, </span><span style=color:#c18401>TimestampsToReturn</span><span>.</span><span style=color:#c18401>Both</span><span>, nodeId)
</span><span>    .</span><span style=color:#e45649>get</span><span>();
</span></code></pre><p>The first parameter, max age, lets the server know that we may be ok reading a value which is a bit older. This could reduce traffic to the underlying device/system. However using zero as a parameter we request a fresh update from the value source.<p>The above call is actually a simplified version of a more complex read call. In OPC UA items do have attributes and there is a “main” attribute, the value. This call defaults to reading the “value” attribute. However it is possible to read all kinds of other attributes from the same item. The next snippet shows the more complex read call, which allows to not only read different attributes of the item, but also multiple items at the same time:<pre class=language-java data-lang=java style=background:#fafafa;color:#383a42><code class=language-java data-lang=java><span style=color:#c18401>ReadValueId</span><span> readValueId </span><span style=color:#a626a4>=
</span><span>  </span><span style=color:#a626a4>new </span><span style=color:#c18401>ReadValueId</span><span>(nodeId, </span><span style=color:#c18401>AttributeId</span><span>.</span><span style=color:#c18401>Value</span><span>.</span><span style=color:#e45649>uid</span><span>(), </span><span style=color:#c18401>null</span><span>, </span><span style=color:#c18401>null</span><span>);
</span><span>
</span><span style=color:#c18401>ReadResponse</span><span> response </span><span style=color:#a626a4>= 
</span><span>  client
</span><span>    .</span><span style=color:#e45649>read</span><span>(</span><span style=color:#c18401>0</span><span>, </span><span style=color:#c18401>TimestampsToReturn</span><span>.</span><span style=color:#c18401>Both</span><span>, </span><span style=color:#c18401>Arrays</span><span>.</span><span style=color:#e45649>asList</span><span>(readValueId))
</span><span>      .</span><span style=color:#e45649>get</span><span>();
</span></code></pre><p>Also for this read call we do request both, the server and source timestamp. OPC UA will timestamp values and so you know when the value switched to this reported value. But it is also possible that the device itself does the timestamping. Depending on your device and application, this can be a real benefit to your use case.<h3 id=subscriptions>Subscriptions</h3><p>As already explained, OPC UA can do way better than explicit single reads. Using subscriptions it is possible to have fine grained control over what you request and even how you request data.<p>When coming from MQTT you know that you get updates once they got published. However you have no control over the frequency you get those updates. Imagine your data source is originally some temperate sensor. It probably is capable of supplying data in a sub-microsecond resolution and frequency. But pushing a value update every microsecond, even if no one listens, is a waste of resources.<h4 id=in-opc-ua>In OPC UA</h4><p>OPC UA does allow you to take control over the subscription process from both sides. When a client creates a new subscription it will provide information like the number of in-flight events, the rate of updates, … the server has the ability to modify the request, but will try to adhere to it. It will then start serving the request. Also will data only be sent of there are actual changes. Imagine a pressure sensor, the value may stay the same for quite a while, but then suddenly change rather quickly. So re-transmitting the same value over and over again, just to achieve high frequency updates when an actual change occurs is again a waste of resources.<p><img alt="OPC UA Subscriptions Example" src=https://dentrassi.de/wp-content/uploads/milo_values_v1.png><p>In order to achieve this in OPC UA the client will request a subscription from the server, the server will fulfill that subscription and notify the client of both value changes and subscription state changes. So the client knows if the connection to the device is broken or if there are simply no updates in the value. If no value changes occurred nothing will be transmitted. Of course there is a heartbeat on the OPC UA connection level (one for all subscriptions), which ensures detection communication loss as well.<h4 id=in-eclipse-milo>In Eclipse Milo</h4><p>The following code snippets will create a new subscription in Milo. The first step is to use the subscription manager and create a new subscription context:<pre class=language-java data-lang=java style=background:#fafafa;color:#383a42><code class=language-java data-lang=java><span style=color:#a0a1a7>// what to read
</span><span style=color:#c18401>ReadValueId</span><span> readValueId </span><span style=color:#a626a4>=
</span><span>    </span><span style=color:#a626a4>new </span><span style=color:#c18401>ReadValueId</span><span>(nodeId, </span><span style=color:#c18401>AttributeId</span><span>.</span><span style=color:#c18401>Value</span><span>.</span><span style=color:#e45649>uid</span><span>(), </span><span style=color:#c18401>null</span><span>, </span><span style=color:#c18401>null</span><span>);
</span><span>
</span><span style=color:#a0a1a7>// monitoring parameters
</span><span style=color:#a626a4>int</span><span> clientHandle </span><span style=color:#a626a4>= </span><span style=color:#c18401>123456789</span><span>;
</span><span style=color:#c18401>MonitoringParameters</span><span> parameters </span><span style=color:#a626a4>=
</span><span>    </span><span style=color:#a626a4>new </span><span style=color:#c18401>MonitoringParameters</span><span>(</span><span style=color:#e45649>uint</span><span>(clientHandle), </span><span style=color:#c18401>1000.0</span><span>, </span><span style=color:#c18401>null</span><span>, </span><span style=color:#e45649>uint</span><span>(</span><span style=color:#c18401>10</span><span>), </span><span style=color:#c18401>true</span><span>);
</span><span>
</span><span style=color:#a0a1a7>// creation request
</span><span style=color:#c18401>MonitoredItemCreateRequest</span><span> request </span><span style=color:#a626a4>=
</span><span>    </span><span style=color:#a626a4>new </span><span style=color:#c18401>MonitoredItemCreateRequest</span><span>(readValueId, </span><span style=color:#c18401>MonitoringMode</span><span>.</span><span style=color:#c18401>Reporting</span><span>, parameters);
</span></code></pre><p>The “client handle” is a client assigned identifier which allows the client to reference the subscribed item later on. If you don’t need to reference by client handle, simply set it so some random or incrementing number.<p>The next step will define an initial setup callback and add the items to the subscription. The setup callback will ensure that the newly created subscription will be able to hook up listeners before the first values are received from the server side, without any race condition:<pre class=language-java data-lang=java style=background:#fafafa;color:#383a42><code class=language-java data-lang=java><span style=color:#a0a1a7>// The actual consumer
</span><span>
</span><span style=color:#c18401>BiConsumer</span><span><</span><span style=color:#c18401>UaMonitoredItem</span><span>, </span><span style=color:#c18401>DataValue</span><span>> consumer </span><span style=color:#a626a4>=
</span><span>  (</span><span style=color:#e45649>item</span><span>, </span><span style=color:#e45649>value</span><span>) </span><span style=color:#a626a4>->
</span><span>    </span><span style=color:#c18401>System</span><span>.out.</span><span style=color:#e45649>format</span><span>(</span><span style=color:#50a14f>"%s -> %s%n"</span><span>, item, value);
</span><span>
</span><span style=color:#a0a1a7>// setting the consumer after the subscription creation
</span><span>
</span><span style=color:#c18401>BiConsumer</span><span><</span><span style=color:#c18401>UaMonitoredItem</span><span>, </span><span style=color:#c18401>Integer</span><span>> onItemCreated </span><span style=color:#a626a4>=
</span><span>  (</span><span style=color:#e45649>monitoredItem</span><span>, </span><span style=color:#e45649>id</span><span>) </span><span style=color:#a626a4>->
</span><span>    monitoredItem.</span><span style=color:#e45649>setValueConsumer</span><span>(consumer);
</span><span>
</span><span style=color:#a0a1a7>// creating the subscription
</span><span>
</span><span style=color:#c18401>UaSubscription</span><span> subscription </span><span style=color:#a626a4>=
</span><span>    client.</span><span style=color:#e45649>getSubscriptionManager</span><span>().</span><span style=color:#e45649>createSubscription</span><span>(</span><span style=color:#c18401>1000.0</span><span>).</span><span style=color:#e45649>get</span><span>();
</span><span>
</span><span style=color:#c18401>List</span><span><</span><span style=color:#c18401>UaMonitoredItem</span><span>> items </span><span style=color:#a626a4>=</span><span> subscription.</span><span style=color:#e45649>createMonitoredItems</span><span>(
</span><span>    </span><span style=color:#c18401>TimestampsToReturn</span><span>.</span><span style=color:#c18401>Both</span><span>,
</span><span>    </span><span style=color:#c18401>Arrays</span><span>.</span><span style=color:#e45649>asList</span><span>(request),
</span><span>    onItemCreated)
</span><span>  .</span><span style=color:#e45649>get</span><span>();
</span></code></pre><h3 id=taking-control>Taking Control</h3><p>Of course consuming telemetry data is fun, but sometimes it is necessary to issue control commands as well. Issuing a command or setting a value on the target device is as easy as:<pre class=language-java data-lang=java style=background:#fafafa;color:#383a42><code class=language-java data-lang=java><span>client
</span><span>  .</span><span style=color:#e45649>writeValue</span><span>(nodeId, </span><span style=color:#c18401>DataValue</span><span>.</span><span style=color:#e45649>valueOnly</span><span>(</span><span style=color:#a626a4>new </span><span style=color:#c18401>Variant</span><span>(</span><span style=color:#c18401>true</span><span>)))
</span><span>    .</span><span style=color:#e45649>get</span><span>();
</span></code></pre><p>This snippet will send the value <code>TRUE</code> to the object identified by <code>nodeId</code>. Of course, like for the read, there are more options when writing values/attributes of an object.<h3 id=but-wait-there-is-more>But wait … there is more!</h3><p>This article only scratched the complex topic of OPC UA. But it should have given you a brief introduction in OPC UA and Eclipse Milo. And it should get you started into OPC UA from a client perspective.<p>Watch out for the repository <a rel="noopener nofollow noreferrer" href=https://github.com/ctron/milo-ece2017 target=_blank>ctron/milo-ece2017</a> which will receive some more content getting into OPC UA and Eclipse Milo and which will be accompanying repository for my talk <a rel="noopener nofollow noreferrer" href=https://www.eclipsecon.org/europe2017/session/developing-opc-ua-eclipse-milo target=_blank>Developing OPC UA with Eclipse Milo™</a> at <a rel="noopener nofollow noreferrer" href=https://www.eclipsecon.org/europe2017/ target=_blank>EclipseCon Europe 2017</a>.<p>I would like to thank <a rel="noopener nofollow noreferrer" href=https://github.com/kevinherron target=_blank>Kevin Herron</a> for not only helping me with this article, but for helping me so many times understanding Milo and OPC UA.<p>Also see:<ul><li><a rel="noopener nofollow noreferrer" href=https://github.com/eclipse/milo target=_blank>eclipse/milo</a> at GitHub<li><a rel="noopener nofollow noreferrer" href=https://iot.eclipse.org/ target=_blank>Eclipse IoT</a><li><a rel="noopener nofollow noreferrer" href=https://eclipse.org/milo target=_blank>Milo project page</a></ul></section></div></article></main><aside class="col-lg-3 order-first order-lg-0 sticky-top mt-lg-5 de-m-collapsible"><div class="de-sidebox de-m-right collapse d-lg-block" id=rightSidebox><div class="d-flex d-md-none pb-3"><div class=row><div class=col><a title="Link to my GitHub profile" class=link-secondary href=https://github.com/ctron target=_blank> <svg class="feather feather-github" viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg> </a></div><div class=col><a title="Link to my Mastodon profile" class=link-secondary href=https://mastodon.dentrassi.de/@ctron target=_blank> <svg viewbox="0 0 24 24" fill=currentColor height=24 stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M23.193 7.879c0-5.206-3.411-6.732-3.411-6.732C18.062.357 15.108.025 12.041 0h-.076c-3.068.025-6.02.357-7.74 1.147 0 0-3.411 1.526-3.411 6.732 0 1.192-.023 2.618.015 4.129.124 5.092.934 10.109 5.641 11.355 2.17.574 4.034.695 5.535.612 2.722-.15 4.25-.972 4.25-.972l-.09-1.975s-1.945.613-4.129.539c-2.165-.074-4.449-.233-4.799-2.891a5.499 5.499 0 0 1-.048-.745s2.125.52 4.817.643c1.646.075 3.19-.097 4.758-.283 3.007-.359 5.625-2.212 5.954-3.905.517-2.665.475-6.507.475-6.507zm-4.024 6.709h-2.497V8.469c0-1.29-.543-1.944-1.628-1.944-1.2 0-1.802.776-1.802 2.312v3.349h-2.483v-3.35c0-1.536-.602-2.312-1.802-2.312-1.085 0-1.628.655-1.628 1.944v6.119H4.832V8.284c0-1.289.328-2.313.987-3.07.68-.758 1.569-1.146 2.674-1.146 1.278 0 2.246.491 2.886 1.474L12 6.585l.622-1.043c.64-.983 1.608-1.474 2.886-1.474 1.104 0 1.994.388 2.674 1.146.658.757.986 1.781.986 3.07v6.304z"/></svg> </a></div><div class=col><a title="Link to my matrix address" class=link-secondary href=https://matrix.to/#%2F%40ctron%3Adentrassi.de target=_blank> <svg class="feather feather-message-square" viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg> </a></div></div></div><div class="de-c-toc mb-4"><h2>Table of Content</h2><ul class="list-unstyled de-c-toc__first" id=toc><li><a class=link-body-emphasis href=#what-is-opc-ua>What is OPC UA?</a><li><a class=link-body-emphasis href=#the-architecture-of-eclipse-milo>The architecture of Eclipse Milo</a><li><a class=link-body-emphasis href=#making-contact>Making contact</a><li><a class=link-body-emphasis href=#node-ids-the-namespace>Node IDs & the namespace</a><li><a class=link-body-emphasis href=#reading-data>Reading data</a><li><a class=link-body-emphasis href=#subscriptions>Subscriptions</a> <ul class="list-unstyled de-c-toc__second"><li><a class=link-body-emphasis href=#in-opc-ua>In OPC UA</a><li><a class=link-body-emphasis href=#in-eclipse-milo>In Eclipse Milo</a></ul><li><a class=link-body-emphasis href=#taking-control>Taking Control</a><li><a class=link-body-emphasis href=#but-wait-there-is-more>But wait … there is more!</a></ul></div><div class="d-lg-block d-none"><div class="de-c-recent-posts mb-2"><h2 class=d-flex><span>Recent Posts</span> <span class=de-c-title__action> <a href=https://staging.dentrassi.de/archive>Archive</a> </span></h2><ul class=list-unstyled><li><a title="Using Ingress on OpenShift backed by Routes" class=link-body-emphasis href=/blog/2021/05/21/using-ingress-on-openshift-backed-by-routes/>Using Ingress on OpenShift backed by Routes</a><li><a title="Recovering from an expired OpenShift certificate" class=link-body-emphasis href=/blog/2021/01/18/recovering-from-an-expired-openshift-certificate/>Recovering from an expired OpenShift certificate</a><li><a title="A Rusty frontend: Patternfly & Yew" class=link-body-emphasis href=/blog/2021/01/08/rusty-frontend-patternfly-yew/>A Rusty frontend: Patternfly & Yew</a><li><a title="OpenShift Update Graph Visualizer, lessons learned" class=link-body-emphasis href=/blog/2020/08/02/openshift-update-graph-visualizer-lessons-learned/>OpenShift Update Graph Visualizer, lessons learned</a><li><a title="Quarkus – Supersonic Subatomic IoT" class=link-body-emphasis href=/blog/2020/06/30/quarkus-supersonic-subatomic-iot/>Quarkus – Supersonic Subatomic IoT</a></ul></div></div></div></aside></div></div><footer class="bg-body-tertiary py-5 mt-lg-5"><div class="container text-body-secondary"><div class=row><div class="col-12 col-lg mb-2">© ctron's blog – All rights reserved</div><div class="col-12 col-lg"><ul class="list-unstyled mb-0"><li><a class=link-secondary href=https://staging.dentrassi.de/legal/disclaimer/>Disclaimer</a><li><a class=link-secondary href=https://staging.dentrassi.de/legal/impress/>Impressum / Impress</a><li><a class=link-secondary href=https://staging.dentrassi.de/legal/privacy/>Datenschutzerklärung / Privacy Policy</a></ul></div><div class="col-12 col-lg"><a class=link-secondary href=https://staging.dentrassi.de/legal/contact/>Contact</a></div></div></div></footer><script src=https://staging.dentrassi.de/js/bootstrap.bundle.min.js></script><script defer src=https://staging.dentrassi.de/elasticlunr.min.js></script><script defer src=https://staging.dentrassi.de/search_index.en.js></script><script defer src=https://staging.dentrassi.de/js/search.js></script>