<!doctype html><html lang=en-US><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><link as=font crossorigin href=dentrassi.de/files/jost-latin-400-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=dentrassi.de/files/jost-latin-500-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=dentrassi.de/files/jost-latin-700-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=dentrassi.de/files/noto-sans-latin-400-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=dentrassi.de/files/noto-sans-latin-500-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=dentrassi.de/files/noto-sans-latin-700-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=dentrassi.de/files/source-code-pro-latin-400-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=dentrassi.de/files/source-code-pro-latin-500-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=dentrassi.de/files/source-code-pro-latin-700-normal.woff2 rel=preload type=font/woff2><link href=dentrassi.de/main.css rel=stylesheet><title>ctron's blog</title><link href=dentrassi.de/atom.xml rel=alternate title=RSS type=application/rss+xml><body data-bs-spy=scroll data-bs-target=#toc tabindex=0><nav class="navbar fixed-top navbar-expand-lg bg-body-tertiary"><div class=container><a class=navbar-brand href=dentrassi.de>ctron's blog</a><div class="d-flex ms-auto me-4 me-lg-0"><div class=row><div class=col><a title="Link to my GitHub profile" class=link-secondary href=https://github.com/ctron target=_blank> <svg class="feather feather-github" viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg> </a></div><div class=col><a title="Link to my Mastodon profile" class=link-secondary href=https://mastodon.dentrassi.de/@ctron target=_blank> <svg viewbox="0 0 24 24" fill=currentColor height=24 stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M23.193 7.879c0-5.206-3.411-6.732-3.411-6.732C18.062.357 15.108.025 12.041 0h-.076c-3.068.025-6.02.357-7.74 1.147 0 0-3.411 1.526-3.411 6.732 0 1.192-.023 2.618.015 4.129.124 5.092.934 10.109 5.641 11.355 2.17.574 4.034.695 5.535.612 2.722-.15 4.25-.972 4.25-.972l-.09-1.975s-1.945.613-4.129.539c-2.165-.074-4.449-.233-4.799-2.891a5.499 5.499 0 0 1-.048-.745s2.125.52 4.817.643c1.646.075 3.19-.097 4.758-.283 3.007-.359 5.625-2.212 5.954-3.905.517-2.665.475-6.507.475-6.507zm-4.024 6.709h-2.497V8.469c0-1.29-.543-1.944-1.628-1.944-1.2 0-1.802.776-1.802 2.312v3.349h-2.483v-3.35c0-1.536-.602-2.312-1.802-2.312-1.085 0-1.628.655-1.628 1.944v6.119H4.832V8.284c0-1.289.328-2.313.987-3.07.68-.758 1.569-1.146 2.674-1.146 1.278 0 2.246.491 2.886 1.474L12 6.585l.622-1.043c.64-.983 1.608-1.474 2.886-1.474 1.104 0 1.994.388 2.674 1.146.658.757.986 1.781.986 3.07v6.304z"/></svg> </a></div><div class=col><a title="Link to my matrix address" class=link-secondary href=https://matrix.to/#%2F%40ctron%3Adentrassi.de target=_blank> <svg class="feather feather-message-square" viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg> </a></div></div></div><button aria-label="Toggle navigation" aria-controls=rightSidebox aria-expanded=false class=navbar-toggler data-bs-target=#rightSidebox data-bs-toggle=collapse type=button><span class=navbar-toggler-icon></span></button></div></nav><div class="de-layout container"><div class="row d-flex align-items-start"><aside class="col-lg-2 order-last order-lg-0 sticky-lg-top mt-4 mt-lg-5"><div class="de-sidebox de-m-left"><div class=mb-4><h2>More</h2><ul class=list-unstyled><li><a class=link-body-emphasis href=/pages/about/>About</a><li><a class=link-body-emphasis href=/pages/pgp-key/>PGP Key</a><li><a class=link-body-emphasis href=/pages/attic/>Attic</a></ul></div><div class=mb-4><h2>Projects</h2><ul class=list-unstyled><li><a class=link-body-emphasis href=/projects/patternfly-yew/>PatternFly Yew</a><li><a class=link-body-emphasis href=/projects/yew-oauth2/>Yew OAuth2</a><li><a class=link-body-emphasis href=/projects/rpm-builder/>Maven RPM Builder</a><li><a class=link-body-emphasis href=/projects/drogue-iot/>Drogue IoT</a><li><a class=link-body-emphasis href=/projects/openshift-update-graph/>OpenShift Update Graph</a><li><a class=link-body-emphasis href=/projects/ecliipse-iot-packages/>Eclipse IoT Packages</a></ul></div></div></aside><main class="col-12 col-lg-7 px-lg-5 mt-3 mt-lg-4"><article class=de-article itemscope itemtype=http://schema.org/BlogPosting><div><section class=de-article__header><h1 itemprop="name headline">Eclipse Milo 0.3, updated examples</h1><div><ul class="de-c-post-meta list-inline text-muted"><li class=list-inline-item><span>3 minute read</span> <meta content=498 itemprop=wordCount><li class=list-inline-item><span content=2019-07-06 itemprop=datePublished> 6 July 2019</span></ul></div></section><hr><section class=de-article__body itemprop=articleBody><p>A while back I wrote<a rel="noopener nofollow noreferrer" href=https://dentrassi.de/2017/09/14/creating-opc-ua-solutions-eclipse-milo/ target=_blank> a blog post about OPC UA, using Milo</a> and added a bunch of examples, in order to get you started. Time passed by and now Milo 0.3.x is released, with a changed API and so those examples no longer work. Not too much has changed, but the experience of running into compile errors isn’t a good one. Finally I found some time to update the examples.<p>This blog post will focus on the changes, compared to the old blog post. As the old blog post is still valid, I though it might make sense to keep it, and introduce the changes of Milo here. The examples repository however is updated to show the new APIs on the <code>master</code> branch.</p><span id=continue-reading></span><h2 id=making-contact>Making contact</h2><p>This is the first situation where you run into the changed API, getting the endpoints. Although the new code is not much different, the old will no longer work:<pre class=language-java data-lang=java style=background:#fafafa;color:#383a42><code class=language-java data-lang=java><span style=color:#c18401>List</span><span><</span><span style=color:#c18401>EndpointDescription</span><span>> endpoints </span><span style=color:#a626a4>=
</span><span>  </span><span style=color:#c18401>DiscoveryClient</span><span>.</span><span style=color:#e45649>getEndpoints</span><span>(</span><span style=color:#50a14f>"opc.tcp://localhost:4840"</span><span>)
</span><span>    .</span><span style=color:#e45649>get</span><span>();
</span></code></pre><p>When you compare that to the old code, then you will notice that instead of an array, now a list is being used and the class name changed. Not too bad.<p>Also, the way you create a new client instance with Milo 0.3.x is a bit different now:<pre class=language-java data-lang=java style=background:#fafafa;color:#383a42><code class=language-java data-lang=java><span style=color:#c18401>OpcUaClientConfigBuilder</span><span> cfg </span><span style=color:#a626a4>= new </span><span style=color:#c18401>OpcUaClientConfigBuilder</span><span>();
</span><span>cfg.</span><span style=color:#e45649>setEndpoint</span><span>(endpoints[</span><span style=color:#c18401>0</span><span>]); </span><span style=color:#a0a1a7>// please do better, and not only pick the first entry
</span><span>
</span><span style=color:#c18401>OpcUaClient</span><span> client </span><span style=color:#a626a4>= </span><span style=color:#c18401>OpcUaClient</span><span>.</span><span style=color:#e45649>create</span><span>(cfg.</span><span style=color:#e45649>build</span><span>());
</span><span>client.</span><span style=color:#e45649>connect</span><span>().</span><span style=color:#e45649>get</span><span>();
</span></code></pre><p>Using the static <code>create</code> method instead of the constructor allows for a bit more processing, before the class instance is actually created. Also may this new method throw an exception now. Handling this in an async way isn’t too hard when you are using Java 9+:<pre class=language-java data-lang=java style=background:#fafafa;color:#383a42><code class=language-java data-lang=java><span style=color:#a626a4>public static </span><span style=color:#c18401>CompletableFuture</span><span><</span><span style=color:#c18401>OpcUaClient</span><span>> </span><span style=color:#e45649>createClient</span><span>(</span><span style=color:#c18401>String</span><span> uri) {
</span><span>  </span><span style=color:#a626a4>return </span><span style=color:#c18401>DiscoveryClient
</span><span>    .</span><span style=color:#e45649>getEndpoints</span><span>(uri) </span><span style=color:#a0a1a7>// look up endpoints from remote
</span><span>    .</span><span style=color:#e45649>thenCompose</span><span>(</span><span style=color:#e45649>endpoints </span><span style=color:#a626a4>-> </span><span>{
</span><span>      </span><span style=color:#a626a4>try </span><span>{
</span><span>        </span><span style=color:#a626a4>return </span><span style=color:#c18401>CompletableFuture</span><span>.</span><span style=color:#e45649>completedFuture</span><span>(
</span><span>            </span><span style=color:#c18401>OpcUaClient</span><span>.</span><span style=color:#e45649>create</span><span>(</span><span style=color:#e45649>buildConfiguration</span><span>(endpoints)) </span><span style=color:#a0a1a7>// "buildConfiguration" should pick an endpoint
</span><span>        );
</span><span>      } </span><span style=color:#a626a4>catch </span><span>(</span><span style=color:#a626a4>final </span><span style=color:#c18401>UaException </span><span style=color:#e45649>e</span><span>) {
</span><span>        </span><span style=color:#a626a4>return </span><span style=color:#c18401>CompletableFuture</span><span>.</span><span style=color:#e45649>failedFuture</span><span>(e);
</span><span>      }
</span><span>    });
</span><span>}
</span></code></pre><h2 id=that-s-it-that-s-it>That’s it? That’s it!</h2><p>Well, pretty much. However, we have only been looking at the client side of Milo. Implementing your own server requires to use the server side API, and that change much more. But to be fair, the changes improve the situation a lot, and make things much easier to use.<h2 id=milo-examples-repository>Milo examples repository</h2><p>As mentioned, the examples in the repository <a rel="noopener nofollow noreferrer" href=https://github.com/ctron/milo-ece2017 target=_blank>ctron/milo-ece2017</a> have been updated as well. They also contain the changed server side, which changed a lot more than the client side.<p>When you <a rel="noopener nofollow noreferrer" href=https://github.com/ctron/milo-ece2017/compare/milo-0.2x...master target=_blank>compare the two branches</a> <code>master</code> and <code>milo-0.2.x</code>, you can see the changed I made for updating to the new version.<p>I hope this helps a bit in getting started with Milo 0.3.x. And please be sure to read the <a rel="noopener nofollow noreferrer" href=https://dentrassi.de/2017/09/14/creating-opc-ua-solutions-eclipse-milo/ target=_blank>original post</a>, giving a more detailed introduction, as well.</section></div></article></main><aside class="col-lg-3 order-first order-lg-0 sticky-top mt-lg-5 de-m-collapsible"><div class="de-sidebox de-m-right collapse d-lg-block" id=rightSidebox><div class="de-c-toc mb-4"><h2>Table of Content</h2><ul class="list-unstyled de-c-toc__first" id=toc><li><a class=link-body-emphasis href=#making-contact>Making contact</a><li><a class=link-body-emphasis href=#that-s-it-that-s-it>That’s it? That’s it!</a><li><a class=link-body-emphasis href=#milo-examples-repository>Milo examples repository</a></ul></div><div class="d-lg-block d-none"><div class="de-c-recent-posts mb-2"><h2 class=d-flex><span>Recent Posts</span> <span class=de-c-title__action> <a href=dentrassi.de/archive>Archive</a> </span></h2><ul class=list-unstyled><li><a title="Using Ingress on OpenShift backed by Routes" class=link-body-emphasis href=/blog/2021/05/21/using-ingress-on-openshift-backed-by-routes/>Using Ingress on OpenShift backed by Routes</a><li><a title="Recovering from an expired OpenShift certificate" class=link-body-emphasis href=/blog/2021/01/18/recovering-from-an-expired-openshift-certificate/>Recovering from an expired OpenShift certificate</a><li><a title="A Rusty frontend: Patternfly & Yew" class=link-body-emphasis href=/blog/2021/01/08/rusty-frontend-patternfly-yew/>A Rusty frontend: Patternfly & Yew</a><li><a title="OpenShift Update Graph Visualizer, lessons learned" class=link-body-emphasis href=/blog/2020/08/02/openshift-update-graph-visualizer-lessons-learned/>OpenShift Update Graph Visualizer, lessons learned</a><li><a title="Quarkus – Supersonic Subatomic IoT" class=link-body-emphasis href=/blog/2020/06/30/quarkus-supersonic-subatomic-iot/>Quarkus – Supersonic Subatomic IoT</a></ul></div></div></div></aside></div></div><footer class="bg-body-tertiary py-5 mt-lg-5"><div class="container text-body-secondary"><div class=row><div class="col-12 col-lg mb-2">© ctron's blog – All rights reserved</div><div class="col-12 col-lg"><ul class="list-unstyled mb-0"><li><a class=link-secondary href=dentrassi.de/legal/disclaimer/>Disclaimer</a><li><a class=link-secondary href=dentrassi.de/legal/impress/>Impressum / Impress</a><li><a class=link-secondary href=dentrassi.de/legal/privacy/>Datenschutzerklärung / Privacy Policy</a></ul></div><div class="col-12 col-lg"><a class=link-secondary href=dentrassi.de/legal/contact/>Contact</a></div></div></div></footer><script src=dentrassi.de/js/bootstrap.bundle.min.js></script><script defer src=dentrassi.de/elasticlunr.min.js></script><script defer src=dentrassi.de/search_index.en.js></script><script defer src=dentrassi.de/js/search.js></script>