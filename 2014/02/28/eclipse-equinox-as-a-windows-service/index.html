<!doctype html><html lang=en-US><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><link as=font crossorigin href=https://dentrassi.de/files/jost-latin-400-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://dentrassi.de/files/jost-latin-500-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://dentrassi.de/files/jost-latin-700-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://dentrassi.de/files/noto-sans-latin-400-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://dentrassi.de/files/noto-sans-latin-500-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://dentrassi.de/files/noto-sans-latin-700-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://dentrassi.de/files/source-code-pro-latin-400-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://dentrassi.de/files/source-code-pro-latin-500-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://dentrassi.de/files/source-code-pro-latin-700-normal.woff2 rel=preload type=font/woff2><link href="https://dentrassi.de/main.css?h=0af1acb576d4063d05c1" rel=stylesheet><meta content="In the Eclipse SCADA project we finally wanted to create a setup of the server components for the Windows platform. Ideally all the server tasks should be integrated into the Windows service framework, so that you can stop and start services “the Windows way”.
" name=description><meta content=article property=og:type><meta content="ctron's blog" property=og:site_name><meta content="Eclipse Equinox as a Windows Service" property=og:title><meta content=https://dentrassi.de/2014/02/28/eclipse-equinox-as-a-windows-service property=og:url><meta content="In the Eclipse SCADA project we finally wanted to create a setup of the server components for the Windows platform. Ideally all the server tasks should be integrated into the Windows service framework, so that you can stop and start services “the Windows way”.
" property=og:description><meta content="Jens Reimann" property=og:author_name><meta content=https://dentrassi.de property=og:author_url><meta content=summary name=twitter:card><meta content=@ctron name=twitter:site><meta content="Eclipse Equinox as a Windows Service" name=twitter:title><meta content="In the Eclipse SCADA project we finally wanted to create a setup of the server components for the Windows platform. Ideally all the server tasks should be integrated into the Windows service framework, so that you can stop and start services “the Windows way”.
" name=twitter:description><meta content=Eclipse property=article:tag><meta content=Equinox property=article:tag><meta content=OSGi property=article:tag><meta content=Windows property=article:tag><title>Eclipse Equinox as a Windows Service – ctron's blog</title><link href=https://dentrassi.de/2014/02/28/eclipse-equinox-as-a-windows-service/ rel=canonical><link href=https://dentrassi.de/rss.xml rel=alternate title=RSS type=application/rss+xml><script>var _paq=window._paq=window._paq||[];_paq.push(['trackPageView']);_paq.push(['enableLinkTracking']);(function(){var a="https://logs.dentrassi.de/";_paq.push(['setTrackerUrl',a+ 'matomo.php']);_paq.push(['setSiteId','1']);var b=document,c=b.createElement('script'),d=b.getElementsByTagName('script')[0];c.async=true;c.src=a+ 'matomo.js';d.parentNode.insertBefore(c,d)})()</script><body data-bs-spy=scroll data-bs-target=#toc tabindex=0><nav class="navbar fixed-top navbar-expand-lg bg-body-tertiary"><div class=container><a class=navbar-brand href=https://dentrassi.de>ctron's blog</a><form class="de-c-search-form d-none d-lg-flex ms-auto me-3"><input placeholder="Search docs" aria-label=Search autocomplete=off class=form-control id=searchInput type=search><div class="shadow bg-white rounded" id=suggestions></div></form><div class="d-none d-md-flex ms-auto ms-lg-0 me-4 me-lg-0"><div class=row><div class=col><a title="Link to my GitHub profile" class=link-secondary href=https://github.com/ctron target=_blank> <svg class="feather feather-github" viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg> </a></div><div class=col><a title="Link to my Mastodon profile" class=link-secondary href=https://mastodon.dentrassi.de/@ctron rel=me target=_blank> <svg viewbox="0 0 24 24" fill=currentColor height=24 stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M23.193 7.879c0-5.206-3.411-6.732-3.411-6.732C18.062.357 15.108.025 12.041 0h-.076c-3.068.025-6.02.357-7.74 1.147 0 0-3.411 1.526-3.411 6.732 0 1.192-.023 2.618.015 4.129.124 5.092.934 10.109 5.641 11.355 2.17.574 4.034.695 5.535.612 2.722-.15 4.25-.972 4.25-.972l-.09-1.975s-1.945.613-4.129.539c-2.165-.074-4.449-.233-4.799-2.891a5.499 5.499 0 0 1-.048-.745s2.125.52 4.817.643c1.646.075 3.19-.097 4.758-.283 3.007-.359 5.625-2.212 5.954-3.905.517-2.665.475-6.507.475-6.507zm-4.024 6.709h-2.497V8.469c0-1.29-.543-1.944-1.628-1.944-1.2 0-1.802.776-1.802 2.312v3.349h-2.483v-3.35c0-1.536-.602-2.312-1.802-2.312-1.085 0-1.628.655-1.628 1.944v6.119H4.832V8.284c0-1.289.328-2.313.987-3.07.68-.758 1.569-1.146 2.674-1.146 1.278 0 2.246.491 2.886 1.474L12 6.585l.622-1.043c.64-.983 1.608-1.474 2.886-1.474 1.104 0 1.994.388 2.674 1.146.658.757.986 1.781.986 3.07v6.304z"/></svg> </a></div><div class=col><a title="Link to my matrix address" class=link-secondary href=https://matrix.to/#%2F%40ctron%3Adentrassi.de target=_blank> <svg class="feather feather-message-square" viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg> </a></div></div></div><button aria-label="Toggle navigation" aria-controls=rightSidebox aria-expanded=false class=navbar-toggler data-bs-target=#rightSidebox data-bs-toggle=collapse type=button><span class=navbar-toggler-icon></span></button></div></nav><div class="de-layout container"><div class="row d-flex align-items-start"><aside class="col-lg-2 order-last order-lg-0 sticky-lg-top mt-4 mt-lg-5"><div class="de-sidebox de-m-left"><div class=mb-4><h2>Projects</h2><ul class=list-unstyled><li><a class=link-body-emphasis href=/projects/patternfly-yew/>PatternFly Yew</a><li><a class=link-body-emphasis href=/projects/yew-oauth2/>Yew OAuth2</a><li><a class=link-body-emphasis href=/projects/rpm-builder/>Maven RPM Builder</a><li><a class=link-body-emphasis href=/projects/openshift-update-graph/>OpenShift Update Graph</a><li><a class=link-body-emphasis href=/projects/oidc-cli/>OIDC Command Line Tool</a></ul></div><div class=mb-4><h2>More</h2><ul class=list-unstyled><li><a class=link-body-emphasis href=/pages/about/>About</a><li><a class=link-body-emphasis href=/pages/pgp-key/>PGP Key</a><li><a class=link-body-emphasis href=/pages/attic/>Attic</a></ul></div></div></aside><main class="col-12 col-lg-7 px-lg-5 mt-3 mt-lg-4"><article class=de-article itemscope itemtype=http://schema.org/BlogPosting><div><section class=de-article__header><h1 itemprop=headline>Eclipse Equinox as a Windows Service</h1><div><div class="de-c-post-meta text-muted"><ul class=list-inline><li class=list-inline-item><span>3 minute read</span> <meta content=428 itemprop=wordCount> <span class=d-none itemprop=author itemscope itemtype=https://schema.org/Person> <a href=https://dentrassi.de itemprop=url> <span itemprop=name>Jens Reimann</span> </a> </span><li class=list-inline-item><span content=2014-02-28T15:55:20+01:00 itemprop=datePublished>28 February 2014</span><li class=list-inline-item><span><a class=link-secondary href=/categories/development>Development</a></span></ul><ul class=list-inline><li class=list-inline-item><a class=link-secondary href=https://dentrassi.de/tags/eclipse/>#eclipse</a> <span> </span> <a class=link-secondary href=https://dentrassi.de/tags/equinox/>#equinox</a> <span> </span> <a class=link-secondary href=https://dentrassi.de/tags/osgi/>#osgi</a> <span> </span> <a class=link-secondary href=https://dentrassi.de/tags/windows/>#windows</a> <span> </span></ul></div></div></section><hr><section class=de-article__body itemprop=articleBody><p>In the Eclipse SCADA project we finally wanted to create a setup of the server components for the Windows platform. Ideally all the server tasks should be integrated into the Windows service framework, so that you can stop and start services “the Windows way”.</p><span id=continue-reading></span><p>While there seems to be a commercial solution (64bit) from <a rel="noopener nofollow noreferrer" href=http://wrapper.tanukisoftware.com target=_blank>Tanuki Software</a>, we wanted (needed) to go the open source way. Which actually brings one to Apache Commons Daemon. Since we are already using “jsvc” (the Unix way) of the library, is made sense to use “prunsrv.exe” for the Windows side.<p>The idea is pretty simple, you specify a class that has two static methods (start and stop) which perform the task of starting and stopping your service. The service wrapper “prunsrv.exe” will take care of loading the JVM. “start” and “stop” will be executed in the same JVM instance, so if you have a global instance variable you have no issues here. Luckily Eclipse/Equinox already has an appropriate class: <a href="http://help.eclipse.org/kepler/index.jsp?topic=%2Forg.eclipse.platform.doc.isv%2Freference%2Fapi%2Forg%2Feclipse%2Fcore%2Fruntime%2Fadaptor%2FEclipseStarter.html" rel="noopener nofollow noreferrer" target=_blank>EclipseStarter</a>.<p>Now comes the facepalm part: While the start method sure must have a signature of “void method ( String [] )” for prunsrv.exe to run, I don’t understand why the “stop” method MUST have the same signature. Of course the authors of EclipseStarter thought the same way, so the stop method (called “shutdown” in this case), accepts no arguments. Which makes prunsrv.exe fail to stop the service.<p>So it was necessary to wrap the call to EclipseStarter in a separate class and provide the correct method signatures:<pre class=language-java data-lang=java style=background:#fafafa;color:#383a42><code class=language-java data-lang=java><span>@</span><span style=color:#e45649>SuppressWarnings </span><span>( </span><span style=color:#50a14f>"restriction" </span><span>)
</span><span style=color:#a626a4>public class </span><span style=color:#c18401>EclipseDaemon
</span><span>{
</span><span>    </span><span style=color:#a626a4>public static void </span><span style=color:#0184bc>start </span><span>( </span><span style=color:#a626a4>final </span><span style=color:#c18401>String</span><span style=color:#a626a4>[] </span><span style=color:#e45649>args </span><span>) </span><span style=color:#a626a4>throws </span><span style=color:#c18401>Exception </span><span>{
</span><span>        </span><span style=color:#c18401>EclipseStarter</span><span>.</span><span style=color:#e45649>main </span><span>( args );
</span><span>    }
</span><span>    </span><span style=color:#a626a4>public static void </span><span style=color:#0184bc>stop </span><span>( </span><span style=color:#a626a4>final </span><span style=color:#c18401>String</span><span style=color:#a626a4>[] </span><span style=color:#e45649>args </span><span>) </span><span style=color:#a626a4>throws </span><span style=color:#c18401>Exception </span><span>{
</span><span>        </span><span style=color:#c18401>EclipseStarter</span><span>.</span><span style=color:#e45649>shutdown </span><span>();
</span><span>    }
</span><span>}
</span></code></pre><p>Since the EclipseStarter class marks itself as “internal” it necessary (or convenient) to use <code>@SuppressWarnings ( "restriction" )</code> for masking out the warnings.<p>Now the class has to be built to a JAR file and installed with the software. So assuming you installed everything to “C:\MyApp\” and you have “C:\MyApp\plugins” with the Equinox OSGi bundles (including “org.eclipse.osgi_*.jar” and “org.eclipse.scada.utils.osgi.daemon_*.jar”), you can create a service like this:<pre style=background:#fafafa;color:#383a42><code><span>prunsrv.exe //IS/MyService
</span><span>  --Classpath "C:\MyApp\plugins\org.eclipse.osgi_&LTversion>.jar;C:\MyApp\plugins\org.eclipse.scada.utils.osgi.daemon_&LTversion>.jar"
</span><span>  --StartMode jvm
</span><span>  --StartClass org.eclipse.scada.utils.osgi.daemon.EclipseDaemon
</span><span>  --StartMethod start
</span><span>  ++StartParams -console
</span><span>  ++StartParams -consoleLog
</span><span>  --StopMode jvm
</span><span>  --StopClass org.eclipse.scada.utils.osgi.daemon.EclipseDaemon
</span><span>  --StopMethod stop
</span></code></pre><p>See also:<ul><li>Full source code of bundle with wrapper class – <a rel="noopener nofollow noreferrer" href=http://git.eclipse.org/c/eclipsescada/org.eclipse.scada.utils.git/tree/org.eclipse.scada.utils.osgi.daemon target=_blank>http://git.eclipse.org/c/eclipsescada/org.eclipse.scada.utils.git/tree/org.eclipse.scada.utils.osgi.daemon</a><li><a rel="noopener nofollow noreferrer" href=https://issues.apache.org/jira/browse/DAEMON-315 target=_blank>DAEMON-315</a><li><a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=429293" rel="noopener nofollow noreferrer" target=_blank>bug #429293</a></ul></section></div></article></main><aside class="col-lg-3 order-first order-lg-0 sticky-top mt-lg-5 de-m-collapsible"><div class="de-sidebox de-m-right collapse d-lg-block" id=rightSidebox><div class="d-flex d-md-none pb-3"><div class=row><div class=col><a title="Link to my GitHub profile" class=link-secondary href=https://github.com/ctron target=_blank> <svg class="feather feather-github" viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg> </a></div><div class=col><a title="Link to my Mastodon profile" class=link-secondary href=https://mastodon.dentrassi.de/@ctron rel=me target=_blank> <svg viewbox="0 0 24 24" fill=currentColor height=24 stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M23.193 7.879c0-5.206-3.411-6.732-3.411-6.732C18.062.357 15.108.025 12.041 0h-.076c-3.068.025-6.02.357-7.74 1.147 0 0-3.411 1.526-3.411 6.732 0 1.192-.023 2.618.015 4.129.124 5.092.934 10.109 5.641 11.355 2.17.574 4.034.695 5.535.612 2.722-.15 4.25-.972 4.25-.972l-.09-1.975s-1.945.613-4.129.539c-2.165-.074-4.449-.233-4.799-2.891a5.499 5.499 0 0 1-.048-.745s2.125.52 4.817.643c1.646.075 3.19-.097 4.758-.283 3.007-.359 5.625-2.212 5.954-3.905.517-2.665.475-6.507.475-6.507zm-4.024 6.709h-2.497V8.469c0-1.29-.543-1.944-1.628-1.944-1.2 0-1.802.776-1.802 2.312v3.349h-2.483v-3.35c0-1.536-.602-2.312-1.802-2.312-1.085 0-1.628.655-1.628 1.944v6.119H4.832V8.284c0-1.289.328-2.313.987-3.07.68-.758 1.569-1.146 2.674-1.146 1.278 0 2.246.491 2.886 1.474L12 6.585l.622-1.043c.64-.983 1.608-1.474 2.886-1.474 1.104 0 1.994.388 2.674 1.146.658.757.986 1.781.986 3.07v6.304z"/></svg> </a></div><div class=col><a title="Link to my matrix address" class=link-secondary href=https://matrix.to/#%2F%40ctron%3Adentrassi.de target=_blank> <svg class="feather feather-message-square" viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg> </a></div></div></div><div class="d-lg-block d-none"><div class="de-c-recent-posts mb-2"><h2 class=d-flex><span>Recent Posts</span> <span class=de-c-title__action> <a href=https://dentrassi.de/archive>Archive</a> </span></h2><ul class=list-unstyled><li><a title="ReSyMo: Remote System Monitoring" class=link-body-emphasis href=/2024/04/07/remote-system-monitoring/>ReSyMo: Remote System Monitoring</a><li><a title="An OpenID Connect command line client" class=link-body-emphasis href=/2024/03/16/oidc-command-line-client/>An OpenID Connect command line client</a><li><a title="Release of Trunk 0.19.0" class=link-body-emphasis href=/2024/03/11/trunk-0-19-0/>Release of Trunk 0.19.0</a><li><a title="Good news everyone: Trunk is back" class=link-body-emphasis href=/2024/01/16/good-news-everyone/>Good news everyone: Trunk is back</a><li><a title="Yew components for OpenID connect and OAuth2" class=link-body-emphasis href=/2023/10/22/yew-oauth2/>Yew components for OpenID connect and OAuth2</a></ul></div></div><div class="de-c-toc mb-4"><h2 class=d-flex><span>Categories</span> <span class=de-c-title__action> <a href=https://dentrassi.de/categories>All</a> </span></h2><ul class=list-unstyled><li><a class=link-body-emphasis href=https://dentrassi.de/categories/development/>Development</a></ul></div><div class="de-c-toc mb-4"><h2 class=d-flex><span>Tags</span> <span class=de-c-title__action> <a href=https://dentrassi.de/tags>All</a> </span></h2><a class=link-body-emphasis href=https://dentrassi.de/tags/eclipse/>#eclipse</a><span> </span><a class=link-body-emphasis href=https://dentrassi.de/tags/equinox/>#equinox</a><span> </span><a class=link-body-emphasis href=https://dentrassi.de/tags/osgi/>#osgi</a><span> </span><a class=link-body-emphasis href=https://dentrassi.de/tags/windows/>#windows</a><span> </span></div></div></aside></div></div><footer class="bg-body-tertiary py-5 mt-lg-5"><div class="container text-body-secondary"><div class=row><div class="col-12 col-lg mb-2">© ctron's blog – All rights reserved</div><div class="col-12 col-lg"><ul class="list-unstyled mb-0"><li><a class=link-secondary href=https://dentrassi.de/legal/disclaimer/>Disclaimer</a><li><a class=link-secondary href=https://dentrassi.de/legal/impress/>Impressum / Impress</a><li><a class=link-secondary href=https://dentrassi.de/legal/privacy/>Datenschutzerklärung / Privacy Policy</a></ul></div><div class="col-12 col-lg"><a class=link-secondary href=https://dentrassi.de/legal/contact/>Contact</a></div></div></div></footer><script src="https://dentrassi.de/js/bootstrap.bundle.min.js?h=0833b2e9c3a26c258476"></script><script src="https://dentrassi.de/elasticlunr.min.js?h=4f648b9e42abdef9c436" defer></script><script src="https://dentrassi.de/js/search.js?h=ed51a29cb343a0c8a535" defer></script><script>window.searchIndexLocation="https://dentrassi.de/search_index.en.json?h=3600f91fa8754c3bc4d8"</script>