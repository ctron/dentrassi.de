<!doctype html><html lang=en-US><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><link as=font crossorigin href=https://staging.dentrassi.de/files/jost-latin-400-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://staging.dentrassi.de/files/jost-latin-500-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://staging.dentrassi.de/files/jost-latin-700-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://staging.dentrassi.de/files/noto-sans-latin-400-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://staging.dentrassi.de/files/noto-sans-latin-500-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://staging.dentrassi.de/files/noto-sans-latin-700-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://staging.dentrassi.de/files/source-code-pro-latin-400-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://staging.dentrassi.de/files/source-code-pro-latin-500-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://staging.dentrassi.de/files/source-code-pro-latin-700-normal.woff2 rel=preload type=font/woff2><link href="https://staging.dentrassi.de/main.css?h=0af1acb576d4063d05c1" rel=stylesheet><meta content="Introduction to oidc-cli, an OpenID Connect command line client.
" name=description><meta content="Jens Reimann" name=author><meta content=article property=og:type><meta content="ctron's blog" property=og:site_name><meta content="An OpenID Connect command line client" property=og:title><meta content=https://staging.dentrassi.de/2024/03/16/oidc-command-line-client property=og:url><meta content="Introduction to oidc-cli, an OpenID Connect command line client.
" property=og:description><meta content="Jens Reimann" property=og:author_name><meta content=https://dentrassi.de property=og:author_url><meta content=2024-03-16T00:00:00+00:00 name=publish_date property=og:publish_date><meta content=summary name=twitter:card><meta content=@ctron name=twitter:site><meta content="An OpenID Connect command line client" name=twitter:title><meta content="Introduction to oidc-cli, an OpenID Connect command line client.
" name=twitter:description><meta content=OIDC property=article:tag><meta content=Authentication property=article:tag><meta content=CLI property=article:tag><meta content=Development property=article:tag><title>An OpenID Connect command line client ‚Äì ctron's blog</title><link href=https://staging.dentrassi.de/2024/03/16/oidc-command-line-client/ rel=canonical><link href=https://staging.dentrassi.de/rss.xml rel=alternate title=RSS type=application/rss+xml><script>var _paq=window._paq=window._paq||[];_paq.push(['trackPageView']);_paq.push(['enableLinkTracking']);(function(){var a="https://logs.dentrassi.de/";_paq.push(['setTrackerUrl',a+ 'matomo.php']);_paq.push(['setSiteId','1']);var b=document,c=b.createElement('script'),d=b.getElementsByTagName('script')[0];c.async=true;c.src=a+ 'matomo.js';d.parentNode.insertBefore(c,d)})()</script><body data-bs-spy=scroll data-bs-target=#toc tabindex=0><nav class="navbar fixed-top navbar-expand-lg bg-body-tertiary"><div class=container><a class=navbar-brand href=https://staging.dentrassi.de>ctron's blog</a><form class="de-c-search-form d-none d-lg-flex ms-auto me-3"><input aria-label=Search autocomplete=off class=form-control id=searchInput placeholder=Search type=search><div class="shadow bg-white rounded" id=suggestions></div></form><div class="d-none d-md-flex ms-auto ms-lg-0 me-4 me-lg-0"><div class=row><div class=col><a title="Link to my GitHub profile" class=link-secondary href=https://github.com/ctron target=_blank> <svg class="feather feather-github" viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg> </a></div><div class=col><a title="Link to my Mastodon profile" class=link-secondary href=https://mastodon.dentrassi.de/@ctron rel=me target=_blank> <svg viewbox="0 0 24 24" fill=currentColor height=24 stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M23.193 7.879c0-5.206-3.411-6.732-3.411-6.732C18.062.357 15.108.025 12.041 0h-.076c-3.068.025-6.02.357-7.74 1.147 0 0-3.411 1.526-3.411 6.732 0 1.192-.023 2.618.015 4.129.124 5.092.934 10.109 5.641 11.355 2.17.574 4.034.695 5.535.612 2.722-.15 4.25-.972 4.25-.972l-.09-1.975s-1.945.613-4.129.539c-2.165-.074-4.449-.233-4.799-2.891a5.499 5.499 0 0 1-.048-.745s2.125.52 4.817.643c1.646.075 3.19-.097 4.758-.283 3.007-.359 5.625-2.212 5.954-3.905.517-2.665.475-6.507.475-6.507zm-4.024 6.709h-2.497V8.469c0-1.29-.543-1.944-1.628-1.944-1.2 0-1.802.776-1.802 2.312v3.349h-2.483v-3.35c0-1.536-.602-2.312-1.802-2.312-1.085 0-1.628.655-1.628 1.944v6.119H4.832V8.284c0-1.289.328-2.313.987-3.07.68-.758 1.569-1.146 2.674-1.146 1.278 0 2.246.491 2.886 1.474L12 6.585l.622-1.043c.64-.983 1.608-1.474 2.886-1.474 1.104 0 1.994.388 2.674 1.146.658.757.986 1.781.986 3.07v6.304z"/></svg> </a></div><div class=col><a title="Link to my matrix address" class=link-secondary href=https://matrix.to/#%2F%40ctron%3Adentrassi.de target=_blank> <svg class="feather feather-message-square" viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg> </a></div></div></div><button aria-label="Toggle navigation" aria-controls=rightSidebox aria-expanded=false class=navbar-toggler data-bs-target=#rightSidebox data-bs-toggle=collapse type=button><span class=navbar-toggler-icon></span></button></div></nav><div class="de-layout container"><div class="row d-flex align-items-start"><aside class="col-lg-2 order-last order-lg-0 sticky-lg-top mt-4 mt-lg-5"><div class="de-sidebox de-m-left"><div class=mb-4><h2>Projects</h2><ul class=list-unstyled><li><a class=link-body-emphasis href=/projects/patternfly-yew/>PatternFly Yew</a><li><a class=link-body-emphasis href=/projects/yew-oauth2/>Yew OAuth2</a><li><a class=link-body-emphasis href=/projects/trunk/>Trunk</a><li><a class=link-body-emphasis href=/projects/openshift-update-graph/>OpenShift Update Graph</a><li><a class=link-body-emphasis href=/projects/oidc-cli/>OIDC CLI</a><li><a class=link-body-emphasis href=/projects/csaf-walker/>CSAF Walker</a><li><a class=link-body-emphasis href=/projects/rpm-builder/>Maven RPM Builder</a></ul></div><div class=mb-4><h2>More</h2><ul class=list-unstyled><li><a class=link-body-emphasis href=/pages/about/>About</a><li><a class=link-body-emphasis href=/pages/pgp-key/>PGP Key</a><li><a class=link-body-emphasis href=/pages/attic/>Attic</a></ul></div></div></aside><main class="col-12 col-lg-7 px-lg-5 mt-3 mt-lg-4"><article class=de-article itemscope itemtype=http://schema.org/BlogPosting><div><section class=de-article__header><h1 itemprop=headline>An OpenID Connect command line client</h1><div><div class="de-c-post-meta text-muted"><ul class=list-inline><li class=list-inline-item><span>5 minute read</span> <meta content=837 itemprop=wordCount> <span class=d-none itemprop=author itemscope itemtype=https://schema.org/Person> <a href=https://dentrassi.de itemprop=url> <span itemprop=name>Jens Reimann</span> </a> </span><li class=list-inline-item><span content=2024-03-16T00:00:00+00:00 itemprop=datePublished>16 March 2024</span><li class=list-inline-item><span><a class=link-secondary href=/categories/technical-stuff>Technical Stuff</a></span></ul><ul class=list-inline><li class=list-inline-item><a class=link-secondary href=https://staging.dentrassi.de/tags/oidc/>#oidc</a> <span> </span> <a class=link-secondary href=https://staging.dentrassi.de/tags/authentication/>#authentication</a> <span> </span> <a class=link-secondary href=https://staging.dentrassi.de/tags/cli/>#cli</a> <span> </span> <a class=link-secondary href=https://staging.dentrassi.de/tags/development/>#development</a> <span> </span></ul></div></div></section><hr><section class=de-article__body itemprop=articleBody><p><a rel="noopener nofollow noreferrer" href=https://openid.net/developers/how-connect-works/ target=_blank>OpenID Connect</a> isn‚Äôt the easiest thing to get into. Access tokens, ID tokens, refresh tokens. The different authentication flows. But all you want is a simple HTTP request from the command line. <code>oidc-cli</code> is here to help.</p><span id=continue-reading></span><h2 id=what-is-oidc>What is OIDC</h2><p>OpenID Connect (or short OIDC) is a great technology. Based on OAuth2, it provides a simple way to get rid of managing user credentials, not only for frontend applications. The downside is that, in order to cover all use cases, it is quite complex.<p>As a user, from a frontend perspective (yes, I mean you and your browser), OIDC is quite comfortable. You come to a new service, see a ‚Äúlogin with X‚Äù button, click it, get redirected to X (no, not that X). Then confirm that you want to log in and share your account information. Get redirected back to the original service. Done. No need to create a new pair of username and password. No need for confirmation e-mails, or other things like that.<p>From the perspective of a provider of such a service, that can also be quite comfortable. Instead of implementing all the username/password, account creation e-mail, recover your password feature, two-factor authentication, all you need to do is to forward the user to e.g., <a rel="noopener nofollow noreferrer" href=https://www.keycloak.org/ target=_blank>Keycloak</a>, and you‚Äôre done. When the user gets redirected back to our website, that redirect will carry a code, and that code can be exchanged with the issuer server (Keycloak) for an access token.<p>The access token will then be set from the frontend to the backend, and the backend knows who you are. In order to prevent misuse of that access token, it has a lifespan of a few minutes, and needs to be refreshed. Refreshing the token can be done with the refresh token, which gives you another short-lived access token.<p>All good.<h2 id=here-comes-the-catch>Here comes the catch</h2><p>Assume you want to do some testing from the command line. Using <code>curl</code> or <code>http</code>. Pretty simple. And it‚Äôs actually pretty simple to pass the token. <code>http "Authorization:Bearer &LTtoken>"</code> and you‚Äôre done.<p>The only question is: where do you get that token from?<p>Well, you get it from the handshake: frontend redirect to the issuer. The issuer logs you in, then redirects you back to the frontend. Which then trades the code for a new token. Quite a few steps. And after a few minutes, you might need to repeat that.<h2 id=solutions>Solutions</h2><p>One way could be to use the ‚Äúclient credentials‚Äù grant. That‚Äôs a ‚Äúmachine to machine‚Äù type of token, where you can trade a ‚Äúclient id‚Äù and ‚Äúclient secret‚Äù for an access token that normally lasts a bit longer (like one hour). Still, you need to do an initial <code>curl</code> call mixed with <code>jq</code> to initially get that.<p>You can also use <a rel="noopener nofollow noreferrer" href=https://www.postman.com/ target=_blank>Postman</a>. It has some integrated support for OAuth2 (which OIDC builds upon). However, the configuration isn‚Äôt that easy, and it is not a pure command line tool.<h2 id=oidc-cli><code>oidc-cli</code></h2><p>Here comes <a rel="noopener nofollow noreferrer" href=https://github.com/ctron/oidc-cli target=_blank><code>oidc-cli</code></a>. <code>oidc-cli</code> is a small, lightweight command line tool.<p>The usage is quite simple. Create a new OIDC login (client), using:<pre class=language-bash data-lang=bash style=background:#fafafa;color:#383a42><code class=language-bash data-lang=bash><span style=color:#e45649>odic</span><span> create public </span><span style=color:#a626a4><</span><span>my-client</span><span style=color:#a626a4>> </span><span>--issuer </span><span style=color:#a626a4><</span><span>issuer url</span><span style=color:#a626a4>> </span><span>--client-id </span><span style=color:#a626a4><</span><span>client-id</span><span style=color:#a626a4>> 
</span></code></pre><p>That will spin up an HTTP server and print out a URL on the console which takes your browser to the login screen of the issuer server. It will as the issuer server to redirect back to the locally spun up HTTP server once it‚Äôs done. When it receives that redirect, it will store that token and have it available for command line use:<pre class=language-bash data-lang=bash style=background:#fafafa;color:#383a42><code class=language-bash data-lang=bash><span style=color:#e45649>oidc</span><span> token </span><span style=color:#a626a4><</span><span>my-client</span><span style=color:#a626a4>>
</span></code></pre><p>That will give you the raw access token. Using <code>-b</code> (or <code>--bearer</code>) you can also get it formatted in a way that you can directly use it as a value to the <code>Authorization</code> HTTP header. For example, using it in combination with <a rel="noopener nofollow noreferrer" href=https://httpie.io/ target=_blank>HTTPie</a>:<pre class=language-bash data-lang=bash style=background:#fafafa;color:#383a42><code class=language-bash data-lang=bash><span style=color:#e45649>http</span><span> localhost/my/api Authorization:$(</span><span style=color:#e45649>oidc</span><span> token</span><span style=color:#e45649> -b </span><span style=color:#a626a4><</span><span>my-client</span><span style=color:#a626a4>></span><span>)
</span></code></pre><h2 id=but-wait-there-is-more>But wait, there is more!</h2><p><code>oidc-cli</code> cannot only work with public, frontend OIDC clients, but also with the ‚Äúclient credentials‚Äù grant mentioned before. You will just need to use <code>oidc create confidential</code>, and <code>--help</code> should tell you more.<p>When the token expires, <code>oidc-cli</code> will automatically try to refresh that token too.<h2 id=what-s-next>What‚Äôs next</h2><p>I hope you would give it a try. Let me know how it works, and what you think is missing.<p>It is a <code>0.1.x</code> version, and it there could be a lot more. Then again, it already does prove itself useful every day. There are a few other flows/grants to support. There could be a lot more options to add (like scopes, nonces, timeouts, ‚Ä¶), and I am happy to expand it when necessary (PRs welcome üòâ). Let me know, create an issue on GitHub!<h2 id=also-see>Also see</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://github.com/ctron/oidc-cli target=_blank>oidc-cli</a> on GitHub<li><a href="https://github.com/ctron/oidc-cli?tab=readme-ov-file#installation" rel="noopener nofollow noreferrer" target=_blank>Installation</a></ul></section></div></article></main><aside class="col-lg-3 order-first order-lg-0 sticky-top mt-lg-5 de-m-collapsible"><div class="de-sidebox de-m-right collapse d-lg-block" id=rightSidebox><div class="d-flex d-md-none pb-3"><div class=row><div class=col><a title="Link to my GitHub profile" class=link-secondary href=https://github.com/ctron target=_blank> <svg class="feather feather-github" viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg> </a></div><div class=col><a title="Link to my Mastodon profile" class=link-secondary href=https://mastodon.dentrassi.de/@ctron rel=me target=_blank> <svg viewbox="0 0 24 24" fill=currentColor height=24 stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M23.193 7.879c0-5.206-3.411-6.732-3.411-6.732C18.062.357 15.108.025 12.041 0h-.076c-3.068.025-6.02.357-7.74 1.147 0 0-3.411 1.526-3.411 6.732 0 1.192-.023 2.618.015 4.129.124 5.092.934 10.109 5.641 11.355 2.17.574 4.034.695 5.535.612 2.722-.15 4.25-.972 4.25-.972l-.09-1.975s-1.945.613-4.129.539c-2.165-.074-4.449-.233-4.799-2.891a5.499 5.499 0 0 1-.048-.745s2.125.52 4.817.643c1.646.075 3.19-.097 4.758-.283 3.007-.359 5.625-2.212 5.954-3.905.517-2.665.475-6.507.475-6.507zm-4.024 6.709h-2.497V8.469c0-1.29-.543-1.944-1.628-1.944-1.2 0-1.802.776-1.802 2.312v3.349h-2.483v-3.35c0-1.536-.602-2.312-1.802-2.312-1.085 0-1.628.655-1.628 1.944v6.119H4.832V8.284c0-1.289.328-2.313.987-3.07.68-.758 1.569-1.146 2.674-1.146 1.278 0 2.246.491 2.886 1.474L12 6.585l.622-1.043c.64-.983 1.608-1.474 2.886-1.474 1.104 0 1.994.388 2.674 1.146.658.757.986 1.781.986 3.07v6.304z"/></svg> </a></div><div class=col><a title="Link to my matrix address" class=link-secondary href=https://matrix.to/#%2F%40ctron%3Adentrassi.de target=_blank> <svg class="feather feather-message-square" viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg> </a></div></div></div><div class="de-c-toc mb-4"><h2>Table of Content</h2><ul class="list-unstyled de-c-toc__first" id=toc><li><a class=link-body-emphasis href=#what-is-oidc>What is OIDC</a><li><a class=link-body-emphasis href=#here-comes-the-catch>Here comes the catch</a><li><a class=link-body-emphasis href=#solutions>Solutions</a><li><a class=link-body-emphasis href=#oidc-cli>oidc-cli</a><li><a class=link-body-emphasis href=#but-wait-there-is-more>But wait, there is more!</a><li><a class=link-body-emphasis href=#what-s-next>What‚Äôs next</a><li><a class=link-body-emphasis href=#also-see>Also see</a></ul></div><div class="d-lg-block d-none"><div class="de-c-recent-posts mb-2"><h2 class=d-flex><span>Recent Posts</span> <span class=de-c-title__action> <a href=https://staging.dentrassi.de/archive>Archive</a> </span></h2><ul class=list-unstyled><li><a title="CSAF Walker: Working with CSAF providers in Rust" class=link-body-emphasis href=/2024/05/19/csaf-walker/>CSAF Walker: Working with CSAF providers in Rust</a><li><a title="WebAssembly loading progress visualization with Trunk" class=link-body-emphasis href=/2024/05/05/webassembly-loading-process-visualization-trunk/>WebAssembly loading progress visualization with Trunk</a><li><a title="ReSyMo: Remote System Monitoring" class=link-body-emphasis href=/2024/04/07/remote-system-monitoring/>ReSyMo: Remote System Monitoring</a><li><a title="An OpenID Connect command line client" class=link-body-emphasis href=/2024/03/16/oidc-command-line-client/>An OpenID Connect command line client</a><li><a title="Release of Trunk 0.19.0" class=link-body-emphasis href=/2024/03/11/trunk-0-19-0/>Release of Trunk 0.19.0</a></ul></div></div><div class="de-c-toc mb-4"><h2 class=d-flex><span>Categories</span> <span class=de-c-title__action> <a href=https://staging.dentrassi.de/categories>All</a> </span></h2><ul class=list-unstyled><li><a class=link-body-emphasis href=https://staging.dentrassi.de/categories/technical-stuff/>Technical Stuff</a><li><a class=link-body-emphasis href=https://staging.dentrassi.de/categories/open-source/>Open Source</a></ul></div><div class="de-c-toc mb-4"><h2 class=d-flex><span>Tags</span> <span class=de-c-title__action> <a href=https://staging.dentrassi.de/tags>All</a> </span></h2><a class=link-body-emphasis href=https://staging.dentrassi.de/tags/oidc/>#oidc</a><span> </span><a class=link-body-emphasis href=https://staging.dentrassi.de/tags/authentication/>#authentication</a><span> </span><a class=link-body-emphasis href=https://staging.dentrassi.de/tags/cli/>#cli</a><span> </span><a class=link-body-emphasis href=https://staging.dentrassi.de/tags/development/>#development</a><span> </span></div></div></aside></div></div><footer class="bg-body-tertiary py-5 mt-lg-5"><div class="container text-body-secondary"><div class=row><div class="col-12 col-lg mb-2">¬© ctron's blog ‚Äì All rights reserved</div><div class="col-12 col-lg"><ul class="list-unstyled mb-0"><li><a class=link-secondary href=https://staging.dentrassi.de/legal/disclaimer/>Disclaimer</a><li><a class=link-secondary href=https://staging.dentrassi.de/legal/impress/>Impressum / Impress</a><li><a class=link-secondary href=https://staging.dentrassi.de/legal/privacy/>Datenschutzerkl√§rung / Privacy Policy</a></ul></div><div class="col-12 col-lg"><a class=link-secondary href=https://staging.dentrassi.de/legal/contact/>Contact</a></div></div></div></footer><script src="https://staging.dentrassi.de/js/bootstrap.bundle.min.js?h=0833b2e9c3a26c258476"></script><script src="https://staging.dentrassi.de/elasticlunr.min.js?h=4f648b9e42abdef9c436" defer></script><script src="https://staging.dentrassi.de/js/search.js?h=ed51a29cb343a0c8a535" defer></script><script>window.searchIndexLocation="https://staging.dentrassi.de/search_index.en.json?h=a10d1d3d5bf8f65ccd05"</script>