<!doctype html><html lang=en-US><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><link as=font crossorigin href=https://staging.dentrassi.de/files/jost-latin-400-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://staging.dentrassi.de/files/jost-latin-500-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://staging.dentrassi.de/files/jost-latin-700-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://staging.dentrassi.de/files/noto-sans-latin-400-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://staging.dentrassi.de/files/noto-sans-latin-500-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://staging.dentrassi.de/files/noto-sans-latin-700-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://staging.dentrassi.de/files/source-code-pro-latin-400-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://staging.dentrassi.de/files/source-code-pro-latin-500-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://staging.dentrassi.de/files/source-code-pro-latin-700-normal.woff2 rel=preload type=font/woff2><link href="https://staging.dentrassi.de/main.css?h=0af1acb576d4063d05c1" rel=stylesheet><meta content="We recently switched from IPfire to OpenWRT in our office. Not only because we let OpenWRT run on an ALIX board (which also IPfire could do), but mostly due to the fact that if you want to extend the system, you really can do it. Development of IPfire seems to be quite difficult, not only technically.
" name=description><meta content="Jens Reimann" name=author><meta content=article property=og:type><meta content="ctron's blog" property=og:site_name><meta content="Extending OpenWRT" property=og:title><meta content=https://staging.dentrassi.de/2012/07/26/extending-openwrt property=og:url><meta content="We recently switched from IPfire to OpenWRT in our office. Not only because we let OpenWRT run on an ALIX board (which also IPfire could do), but mostly due to the fact that if you want to extend the system, you really can do it. Development of IPfire seems to be quite difficult, not only technically.
" property=og:description><meta content="Jens Reimann" property=og:author_name><meta content=https://dentrassi.de property=og:author_url><meta content=2012-07-26T15:35:32+02:00 name=publish_date property=og:publish_date><meta content=summary name=twitter:card><meta content=@ctron name=twitter:site><meta content="Extending OpenWRT" name=twitter:title><meta content="We recently switched from IPfire to OpenWRT in our office. Not only because we let OpenWRT run on an ALIX board (which also IPfire could do), but mostly due to the fact that if you want to extend the system, you really can do it. Development of IPfire seems to be quite difficult, not only technically.
" name=twitter:description><meta content=OpenWRT property=article:tag><title>Extending OpenWRT – ctron's blog</title><link href=https://staging.dentrassi.de/2012/07/26/extending-openwrt/ rel=canonical><link href=https://staging.dentrassi.de/rss.xml rel=alternate title=RSS type=application/rss+xml><script>var _paq=window._paq=window._paq||[];_paq.push(['trackPageView']);_paq.push(['enableLinkTracking']);(function(){var a="https://logs.dentrassi.de/";_paq.push(['setTrackerUrl',a+ 'matomo.php']);_paq.push(['setSiteId','1']);var b=document,c=b.createElement('script'),d=b.getElementsByTagName('script')[0];c.async=true;c.src=a+ 'matomo.js';d.parentNode.insertBefore(c,d)})()</script><body data-bs-spy=scroll data-bs-target=#toc tabindex=0><nav class="navbar fixed-top navbar-expand-lg bg-body-tertiary"><div class=container><a class=navbar-brand href=https://staging.dentrassi.de>ctron's blog</a><form class="de-c-search-form d-none d-lg-flex ms-auto me-3"><input aria-label=Search autocomplete=off class=form-control id=searchInput placeholder=Search type=search><div class="shadow bg-white rounded" id=suggestions></div></form><div class="d-none d-md-flex ms-auto ms-lg-0 me-4 me-lg-0"><div class=row><div class=col><a title="Link to my GitHub profile" class=link-secondary href=https://github.com/ctron target=_blank> <svg class="feather feather-github" viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg> </a></div><div class=col><a title="Link to my Mastodon profile" class=link-secondary href=https://mastodon.dentrassi.de/@ctron rel=me target=_blank> <svg viewbox="0 0 24 24" fill=currentColor height=24 stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M23.193 7.879c0-5.206-3.411-6.732-3.411-6.732C18.062.357 15.108.025 12.041 0h-.076c-3.068.025-6.02.357-7.74 1.147 0 0-3.411 1.526-3.411 6.732 0 1.192-.023 2.618.015 4.129.124 5.092.934 10.109 5.641 11.355 2.17.574 4.034.695 5.535.612 2.722-.15 4.25-.972 4.25-.972l-.09-1.975s-1.945.613-4.129.539c-2.165-.074-4.449-.233-4.799-2.891a5.499 5.499 0 0 1-.048-.745s2.125.52 4.817.643c1.646.075 3.19-.097 4.758-.283 3.007-.359 5.625-2.212 5.954-3.905.517-2.665.475-6.507.475-6.507zm-4.024 6.709h-2.497V8.469c0-1.29-.543-1.944-1.628-1.944-1.2 0-1.802.776-1.802 2.312v3.349h-2.483v-3.35c0-1.536-.602-2.312-1.802-2.312-1.085 0-1.628.655-1.628 1.944v6.119H4.832V8.284c0-1.289.328-2.313.987-3.07.68-.758 1.569-1.146 2.674-1.146 1.278 0 2.246.491 2.886 1.474L12 6.585l.622-1.043c.64-.983 1.608-1.474 2.886-1.474 1.104 0 1.994.388 2.674 1.146.658.757.986 1.781.986 3.07v6.304z"/></svg> </a></div><div class=col><a title="Link to my matrix address" class=link-secondary href=https://matrix.to/#%2F%40ctron%3Adentrassi.de target=_blank> <svg class="feather feather-message-square" viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg> </a></div></div></div><button aria-label="Toggle navigation" aria-controls=rightSidebox aria-expanded=false class=navbar-toggler data-bs-target=#rightSidebox data-bs-toggle=collapse type=button><span class=navbar-toggler-icon></span></button></div></nav><div class="de-layout container"><div class="row d-flex align-items-start"><aside class="col-lg-2 order-last order-lg-0 sticky-lg-top mt-4 mt-lg-5"><div class="de-sidebox de-m-left"><div class=mb-4><h2>Projects</h2><ul class=list-unstyled><li><a class=link-body-emphasis href=/projects/patternfly-yew/>PatternFly Yew</a><li><a class=link-body-emphasis href=/projects/yew-oauth2/>Yew OAuth2</a><li><a class=link-body-emphasis href=/projects/trunk/>Trunk</a><li><a class=link-body-emphasis href=/projects/openshift-update-graph/>OpenShift Update Graph</a><li><a class=link-body-emphasis href=/projects/oidc-cli/>OIDC CLI</a><li><a class=link-body-emphasis href=/projects/csaf-walker/>CSAF Walker</a><li><a class=link-body-emphasis href=/projects/rpm-builder/>Maven RPM Builder</a></ul></div><div class=mb-4><h2>More</h2><ul class=list-unstyled><li><a class=link-body-emphasis href=/pages/about/>About</a><li><a class=link-body-emphasis href=/pages/pgp-key/>PGP Key</a><li><a class=link-body-emphasis href=/pages/attic/>Attic</a></ul></div></div></aside><main class="col-12 col-lg-7 px-lg-5 mt-3 mt-lg-4"><article class=de-article itemscope itemtype=http://schema.org/BlogPosting><div><section class=de-article__header><h1 itemprop=headline>Extending OpenWRT</h1><div><div class="de-c-post-meta text-muted"><ul class=list-inline><li class=list-inline-item><span>3 minute read</span> <meta content=495 itemprop=wordCount> <span class=d-none itemprop=author itemscope itemtype=https://schema.org/Person> <a href=https://dentrassi.de itemprop=url> <span itemprop=name>Jens Reimann</span> </a> </span><li class=list-inline-item><span content=2012-07-26T15:35:32+02:00 itemprop=datePublished>26 July 2012</span><li class=list-inline-item><span><a class=link-secondary href=/categories/development>Development</a></span></ul><ul class=list-inline><li class=list-inline-item><a class=link-secondary href=https://staging.dentrassi.de/tags/openwrt/>#openwrt</a> <span> </span></ul></div></div></section><hr><section class=de-article__body itemprop=articleBody><p>We recently switched from IPfire to OpenWRT in our office. Not only because we let OpenWRT run on an ALIX board (which also IPfire could do), but mostly due to the fact that if you want to extend the system, you really can do it. Development of IPfire seems to be quite difficult, not only technically.</p><span id=continue-reading></span><p>On the other hand, OpenWRT quickly provides help if you want to contribute. Even to the “noob” questions you will post in the beginning ;-)<p>My initial idea was to create a small plugin for OpenWRT which allows one to configure “pptpd” and VPN users using the web interface LUCI. While OpenWRTs configuration system (called UCI) handles the configuraton model in the background, LuCI brings this models to a Lua driven web user interface. UCI and LuCI play well together, you only need to know how it works together.<p>At first, you will need to set up your build environment (<a rel="noopener nofollow noreferrer" href=http://wiki.openwrt.org/doc/howto/buildroot.exigence target=_blank>http://wiki.openwrt.org/doc/howto/buildroot.exigence</a>) and compile at least the basics (<a rel="noopener nofollow noreferrer" href=http://wiki.openwrt.org/doc/howto/build target=_blank>http://wiki.openwrt.org/doc/howto/build</a>). This was ok for me since I planned on creating script and lua based stuff only. So there was no big issue with “cross-compile” issues.<p>Creating new module, you should set up a new “feed” (see <a rel="noopener nofollow noreferrer" href=http://wiki.openwrt.org/doc/devel/feeds target=_blank>http://wiki.openwrt.org/doc/devel/feeds</a>). I created a new <code>feeds.conf</code> file and added my local git repository. Updating using <code>./scripts/feeds update myfeed</code> to pull the updated feed and installing the module from your feed to your build environment using <code>./scripts/feeds install custompackage</code>. After that <code>make menuconfig</code> and add the newly added module to your build setup. Build your module only using <code>make package/custompackage/compile V=99</code>.<p>I started with a new configuration file for UCI in “/etc/config/users”. The question was after updating in the LuCI interface (or the command line) how does the change get applied? Editing the configuration using UCI and commiting does nothing at first. You will need a service (/etc/init.d script) which will convert the UCI data you are intereseted in and create a configuration or (or whatever your service needs) and start your service then. Using LuCI there is another configuration (/etc/config/ucitrack) which has a mapping between UCI configurations and services. Once LuCI changes the UCI configuration it also restarts the coresponding service. Since I only wanted to convert my users to a /etc/ppp/chap-secrets file, my “service” was only a start section in an init.d script which simply converted the users and did not start any service at all.<p>For deployment, the OpenWRT build system created “ipkg” files which can be transferred to the system easily and be applied. In the install and remove script you will need to use UCI’s command line tool in order to add and remove your service from the “ucitrack” configuration.<p>If you want to see the source of all this, check out <a rel="noopener nofollow noreferrer" href=https://bitbucket.org/ctron/th4wrt target=_blank>https://bitbucket.org/ctron/th4wrt</a> which contains the background “service” and the LuCI interface.</section></div></article></main><aside class="col-lg-3 order-first order-lg-0 sticky-top mt-lg-5 de-m-collapsible"><div class="de-sidebox de-m-right collapse d-lg-block" id=rightSidebox><div class="d-flex d-md-none pb-3"><div class=row><div class=col><a title="Link to my GitHub profile" class=link-secondary href=https://github.com/ctron target=_blank> <svg class="feather feather-github" viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg> </a></div><div class=col><a title="Link to my Mastodon profile" class=link-secondary href=https://mastodon.dentrassi.de/@ctron rel=me target=_blank> <svg viewbox="0 0 24 24" fill=currentColor height=24 stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M23.193 7.879c0-5.206-3.411-6.732-3.411-6.732C18.062.357 15.108.025 12.041 0h-.076c-3.068.025-6.02.357-7.74 1.147 0 0-3.411 1.526-3.411 6.732 0 1.192-.023 2.618.015 4.129.124 5.092.934 10.109 5.641 11.355 2.17.574 4.034.695 5.535.612 2.722-.15 4.25-.972 4.25-.972l-.09-1.975s-1.945.613-4.129.539c-2.165-.074-4.449-.233-4.799-2.891a5.499 5.499 0 0 1-.048-.745s2.125.52 4.817.643c1.646.075 3.19-.097 4.758-.283 3.007-.359 5.625-2.212 5.954-3.905.517-2.665.475-6.507.475-6.507zm-4.024 6.709h-2.497V8.469c0-1.29-.543-1.944-1.628-1.944-1.2 0-1.802.776-1.802 2.312v3.349h-2.483v-3.35c0-1.536-.602-2.312-1.802-2.312-1.085 0-1.628.655-1.628 1.944v6.119H4.832V8.284c0-1.289.328-2.313.987-3.07.68-.758 1.569-1.146 2.674-1.146 1.278 0 2.246.491 2.886 1.474L12 6.585l.622-1.043c.64-.983 1.608-1.474 2.886-1.474 1.104 0 1.994.388 2.674 1.146.658.757.986 1.781.986 3.07v6.304z"/></svg> </a></div><div class=col><a title="Link to my matrix address" class=link-secondary href=https://matrix.to/#%2F%40ctron%3Adentrassi.de target=_blank> <svg class="feather feather-message-square" viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg> </a></div></div></div><div class="d-lg-block d-none"><div class="de-c-recent-posts mb-2"><h2 class=d-flex><span>Recent Posts</span> <span class=de-c-title__action> <a href=https://staging.dentrassi.de/archive>Archive</a> </span></h2><ul class=list-unstyled><li><a title="CSAF Walker: Working with CSAF providers in Rust" class=link-body-emphasis href=/2024/05/19/csaf-walker/>CSAF Walker: Working with CSAF providers in Rust</a><li><a title="WebAssembly loading progress visualization with Trunk" class=link-body-emphasis href=/2024/05/05/webassembly-loading-process-visualization-trunk/>WebAssembly loading progress visualization with Trunk</a><li><a title="ReSyMo: Remote System Monitoring" class=link-body-emphasis href=/2024/04/07/remote-system-monitoring/>ReSyMo: Remote System Monitoring</a><li><a title="An OpenID Connect command line client" class=link-body-emphasis href=/2024/03/16/oidc-command-line-client/>An OpenID Connect command line client</a><li><a title="Release of Trunk 0.19.0" class=link-body-emphasis href=/2024/03/11/trunk-0-19-0/>Release of Trunk 0.19.0</a></ul></div></div><div class="de-c-toc mb-4"><h2 class=d-flex><span>Categories</span> <span class=de-c-title__action> <a href=https://staging.dentrassi.de/categories>All</a> </span></h2><ul class=list-unstyled><li><a class=link-body-emphasis href=https://staging.dentrassi.de/categories/development/>Development</a></ul></div><div class="de-c-toc mb-4"><h2 class=d-flex><span>Tags</span> <span class=de-c-title__action> <a href=https://staging.dentrassi.de/tags>All</a> </span></h2><a class=link-body-emphasis href=https://staging.dentrassi.de/tags/openwrt/>#openwrt</a><span> </span></div></div></aside></div></div><footer class="bg-body-tertiary py-5 mt-lg-5"><div class="container text-body-secondary"><div class=row><div class="col-12 col-lg mb-2">© ctron's blog – All rights reserved</div><div class="col-12 col-lg"><ul class="list-unstyled mb-0"><li><a class=link-secondary href=https://staging.dentrassi.de/legal/disclaimer/>Disclaimer</a><li><a class=link-secondary href=https://staging.dentrassi.de/legal/impress/>Impressum / Impress</a><li><a class=link-secondary href=https://staging.dentrassi.de/legal/privacy/>Datenschutzerklärung / Privacy Policy</a></ul></div><div class="col-12 col-lg"><a class=link-secondary href=https://staging.dentrassi.de/legal/contact/>Contact</a></div></div></div></footer><script src="https://staging.dentrassi.de/js/bootstrap.bundle.min.js?h=0833b2e9c3a26c258476"></script><script src="https://staging.dentrassi.de/elasticlunr.min.js?h=4f648b9e42abdef9c436" defer></script><script src="https://staging.dentrassi.de/js/search.js?h=ed51a29cb343a0c8a535" defer></script><script>window.searchIndexLocation="https://staging.dentrassi.de/search_index.en.json?h=27cd61b8b570a46c62d8"</script>