<!doctype html><html lang=en-US><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><link as=font crossorigin href=https://staging.dentrassi.de/files/jost-latin-400-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://staging.dentrassi.de/files/jost-latin-500-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://staging.dentrassi.de/files/jost-latin-700-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://staging.dentrassi.de/files/noto-sans-latin-400-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://staging.dentrassi.de/files/noto-sans-latin-500-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://staging.dentrassi.de/files/noto-sans-latin-700-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://staging.dentrassi.de/files/source-code-pro-latin-400-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://staging.dentrassi.de/files/source-code-pro-latin-500-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://staging.dentrassi.de/files/source-code-pro-latin-700-normal.woff2 rel=preload type=font/woff2><link href="https://staging.dentrassi.de/main.css?h=6ca7df27c656cad9f823" rel=stylesheet><meta content="Now when you build OSGi bundles using Maven Tycho, you probably ran into the issue of creating a meaningful version qualifier (remember, an OSGi versions always is major.minor.micro.qualifier, so no dash and definitely no -SNAPSHOT).
There are a few approaches ranging from fully manual assignment of the build qualifier, simple timestamps and timestamps based on the last Git change.
" name=description><meta content=article property=og:type><meta content="ctron's blog" property=og:site_name><meta content="Maven Tycho/JGit based build timestamps and the `target` directory" property=og:title><meta content=https://staging.dentrassi.de/2015/07/28/maven-tychojgit-based-build-timestamps-and-the-target-directory property=og:url><meta content="Now when you build OSGi bundles using Maven Tycho, you probably ran into the issue of creating a meaningful version qualifier (remember, an OSGi versions always is major.minor.micro.qualifier, so no dash and definitely no -SNAPSHOT).
There are a few approaches ranging from fully manual assignment of the build qualifier, simple timestamps and timestamps based on the last Git change.
" property=og:description><meta content="Jens Reimann" property=og:author_name><meta content=https://dentrassi.de property=og:author_url><meta content=summary name=twitter:card><meta content=@ctron name=twitter:site><meta content="Maven Tycho/JGit based build timestamps and the `target` directory" name=twitter:title><meta content="Now when you build OSGi bundles using Maven Tycho, you probably ran into the issue of creating a meaningful version qualifier (remember, an OSGi versions always is major.minor.micro.qualifier, so no dash and definitely no -SNAPSHOT).
There are a few approaches ranging from fully manual assignment of the build qualifier, simple timestamps and timestamps based on the last Git change.
" name=twitter:description><meta content=Java property=article:tag><meta content=Maven property=article:tag><meta content=OSGi property=article:tag><meta content=Tycho property=article:tag><title>Maven Tycho/JGit based build timestamps and the `target` directory – ctron's blog</title><link href=https://staging.dentrassi.de/2015/07/28/maven-tychojgit-based-build-timestamps-and-the-target-directory/ rel=canonical><link href=https://staging.dentrassi.de/rss.xml rel=alternate title=RSS type=application/rss+xml><script>var _paq=window._paq=window._paq||[];_paq.push(['trackPageView']);_paq.push(['enableLinkTracking']);(function(){var a="https://logs.dentrassi.de/";_paq.push(['setTrackerUrl',a+ 'matomo.php']);_paq.push(['setSiteId','1']);var b=document,c=b.createElement('script'),d=b.getElementsByTagName('script')[0];c.async=true;c.src=a+ 'matomo.js';d.parentNode.insertBefore(c,d)})()</script><body data-bs-spy=scroll data-bs-target=#toc tabindex=0><nav class="navbar fixed-top navbar-expand-lg bg-body-tertiary"><div class=container><a class=navbar-brand href=https://staging.dentrassi.de>ctron's blog</a><form class="de-c-search-form d-none d-lg-flex ms-auto me-3"><input placeholder="Search docs" aria-label=Search autocomplete=off class=form-control id=searchInput type=search><div class="shadow bg-white rounded" id=suggestions></div></form><div class="d-none d-md-flex ms-auto ms-lg-0 me-4 me-lg-0"><div class=row><div class=col><a title="Link to my GitHub profile" class=link-secondary href=https://github.com/ctron target=_blank> <svg class="feather feather-github" viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg> </a></div><div class=col><a title="Link to my Mastodon profile" class=link-secondary href=https://mastodon.dentrassi.de/@ctron rel=me target=_blank> <svg viewbox="0 0 24 24" fill=currentColor height=24 stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M23.193 7.879c0-5.206-3.411-6.732-3.411-6.732C18.062.357 15.108.025 12.041 0h-.076c-3.068.025-6.02.357-7.74 1.147 0 0-3.411 1.526-3.411 6.732 0 1.192-.023 2.618.015 4.129.124 5.092.934 10.109 5.641 11.355 2.17.574 4.034.695 5.535.612 2.722-.15 4.25-.972 4.25-.972l-.09-1.975s-1.945.613-4.129.539c-2.165-.074-4.449-.233-4.799-2.891a5.499 5.499 0 0 1-.048-.745s2.125.52 4.817.643c1.646.075 3.19-.097 4.758-.283 3.007-.359 5.625-2.212 5.954-3.905.517-2.665.475-6.507.475-6.507zm-4.024 6.709h-2.497V8.469c0-1.29-.543-1.944-1.628-1.944-1.2 0-1.802.776-1.802 2.312v3.349h-2.483v-3.35c0-1.536-.602-2.312-1.802-2.312-1.085 0-1.628.655-1.628 1.944v6.119H4.832V8.284c0-1.289.328-2.313.987-3.07.68-.758 1.569-1.146 2.674-1.146 1.278 0 2.246.491 2.886 1.474L12 6.585l.622-1.043c.64-.983 1.608-1.474 2.886-1.474 1.104 0 1.994.388 2.674 1.146.658.757.986 1.781.986 3.07v6.304z"/></svg> </a></div><div class=col><a title="Link to my matrix address" class=link-secondary href=https://matrix.to/#%2F%40ctron%3Adentrassi.de target=_blank> <svg class="feather feather-message-square" viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg> </a></div></div></div><button aria-label="Toggle navigation" aria-controls=rightSidebox aria-expanded=false class=navbar-toggler data-bs-target=#rightSidebox data-bs-toggle=collapse type=button><span class=navbar-toggler-icon></span></button></div></nav><div class="de-layout container"><div class="row d-flex align-items-start"><aside class="col-lg-2 order-last order-lg-0 sticky-lg-top mt-4 mt-lg-5"><div class="de-sidebox de-m-left"><div class=mb-4><h2>More</h2><ul class=list-unstyled><li><a class=link-body-emphasis href=/pages/about/>About</a><li><a class=link-body-emphasis href=/pages/pgp-key/>PGP Key</a><li><a class=link-body-emphasis href=/pages/attic/>Attic</a></ul></div><div class=mb-4><h2>Projects</h2><ul class=list-unstyled><li><a class=link-body-emphasis href=/projects/patternfly-yew/>PatternFly Yew</a><li><a class=link-body-emphasis href=/projects/yew-oauth2/>Yew OAuth2</a><li><a class=link-body-emphasis href=/projects/rpm-builder/>Maven RPM Builder</a><li><a class=link-body-emphasis href=/projects/drogue-iot/>Drogue IoT</a><li><a class=link-body-emphasis href=/projects/openshift-update-graph/>OpenShift Update Graph</a><li><a class=link-body-emphasis href=/projects/ecliipse-iot-packages/>Eclipse IoT Packages</a></ul></div></div></aside><main class="col-12 col-lg-7 px-lg-5 mt-3 mt-lg-4"><article class=de-article itemscope itemtype=http://schema.org/BlogPosting><div><section class=de-article__header><h1 itemprop=headline>Maven Tycho/JGit based build timestamps and the `target` directory</h1><div><div class="de-c-post-meta text-muted"><ul class=list-inline><li class=list-inline-item><span>4 minute read</span> <meta content=626 itemprop=wordCount> <span class=d-none itemprop=author itemscope itemtype=https://schema.org/Person> <a href=https://dentrassi.de itemprop=url> <span itemprop=name>Jens Reimann</span> </a> </span><li class=list-inline-item><span content=2015-07-28T09:39:20+02:00 itemprop=datePublished>28 July 2015</span><li class=list-inline-item><span><a class=link-secondary href=/categories/development>Development</a></span></ul><ul class=list-inline><li class=list-inline-item><a class=link-secondary href=https://staging.dentrassi.de/tags/java/>#java</a> <span> </span> <a class=link-secondary href=https://staging.dentrassi.de/tags/maven/>#maven</a> <span> </span> <a class=link-secondary href=https://staging.dentrassi.de/tags/osgi/>#osgi</a> <span> </span> <a class=link-secondary href=https://staging.dentrassi.de/tags/tycho/>#tycho</a> <span> </span></ul></div></div></section><hr><section class=de-article__body itemprop=articleBody><p>Now when you build OSGi bundles using Maven <a rel="noopener nofollow noreferrer" href=https://eclipse.org/tycho/ target=_blank>Tycho</a>, you probably ran into the issue of creating a meaningful version qualifier (remember, an OSGi versions always is <code>major.minor.micro.qualifier</code>, so no dash and definitely no <code>-SNAPSHOT</code>).<p>There are a few approaches ranging from fully manual assignment of the build qualifier, simple timestamps and timestamps based on the last Git change.</p><span id=continue-reading></span><h2 id=the-background>The background</h2><p>The latter one is described in the <a rel="noopener nofollow noreferrer" href=https://wiki.eclipse.org/Tycho/Reproducible_Version_Qualifiers target=_blank>“Reproducible Version Qualifiers”</a> wiki page of Tycho as a recipe to create the same qualifier from the same source code revision.<p>Actually the idea is pretty simple, so instead of the current timestamp, the last relevant change in the git repository, for the directory of the bundle, is located and then used to generate the timestamp based qualifier.<p>As a side note: Personally I came to the conclusion, that this sounds great in the beginning, but turns out to be troublesome later. First if all, the Build Qualifier plugin conflicts with the Source Ref Plugin, which generates a different manifest. Both plugins find different <q>last commits</q> and therefore a different <tt>MANIFEST.MF</tt> gets generated. So two builds produce two bundles, with the same qualifier, but actually (due to the <tt>MANIFEST.MF</tt>) different content, with two different checksums, which causes issues later on and has to be cleaned up by some <q>baseline</q> repository matching. In addition you simple cannot guarantee that two different builds come to the same result. Too many components (actually Maven and the local host) are outside of the source code repository and still influence the output of the build. But this post is about the JGit based timestamps ;-)<p>A simple configuration using the Git based approach looks like this in the parent <tt>pom</tt> file:<pre class=language-xml data-lang=xml style=background:#fafafa;color:#383a42><code class=language-xml data-lang=xml><span><</span><span style=color:#e45649>plugin</span><span>>
</span><span>  <</span><span style=color:#e45649>groupId</span><span>>org.eclipse.tycho&LT/</span><span style=color:#e45649>groupId</span><span>>
</span><span>  <</span><span style=color:#e45649>artifactId</span><span>>tycho-packaging-plugin&LT/</span><span style=color:#e45649>artifactId</span><span>>
</span><span>  <</span><span style=color:#e45649>version</span><span>>${tycho.version}&LT/</span><span style=color:#e45649>version</span><span>>
</span><span>  <</span><span style=color:#e45649>dependencies</span><span>>
</span><span>    <</span><span style=color:#e45649>dependency</span><span>>
</span><span>      <</span><span style=color:#e45649>groupId</span><span>>org.eclipse.tycho.extras&LT/</span><span style=color:#e45649>groupId</span><span>>
</span><span>      <</span><span style=color:#e45649>artifactId</span><span>>tycho-buildtimestamp-jgit&LT/</span><span style=color:#e45649>artifactId</span><span>>
</span><span>      <</span><span style=color:#e45649>version</span><span>>${tycho-extras.version}&LT/</span><span style=color:#e45649>version</span><span>>
</span><span>    &LT/</span><span style=color:#e45649>dependency</span><span>>
</span><span>  &LT/</span><span style=color:#e45649>dependencies</span><span>>
</span><span>  <</span><span style=color:#e45649>configuration</span><span>>
</span><span>    <</span><span style=color:#e45649>timestampProvider</span><span>>jgit&LT/</span><span style=color:#e45649>timestampProvider</span><span>>
</span><span>    <</span><span style=color:#e45649>jgit.ignore</span><span>>
</span><span>    pom.xml
</span><span>    &LT/</span><span style=color:#e45649>jgit.ignore</span><span>>
</span><span>  &LT/</span><span style=color:#e45649>configuration</span><span>>
</span><span>&LT/</span><span style=color:#e45649>plugin</span><span>>
</span></code></pre><p>As you can see, there is a configuration property <code>jgit.ignore</code> which allows to exclude a set of files in the search of the last relevant commit. So git changes, which are only changing files which are ignored, are also ignored in this search for the last modification timestamp. Since the <tt>pom.xml</tt> will probably just get changed to point to a different parent POM, this seems like a good idea.<h2 id=the-problem>The problem</h2><p>Now what does happen, when there are uncommitted changes in the working tree? Then it would not be possible for the build to determine the last relevant commit, since the change is not committed! Maven Tycho does provide a way to handle this (aka “Dirty working tree behaviour”) and will allow you to ignore this. Which might not be a good idea after all. The default behavior is to simply error and fail the build.<p>For me it became a real annoyance when it complained about the “<tt>target</tt>” directory itself. The truth is, this output directory should be added to the “<tt>.gitignore</tt>” file anyway, which would then also be respected by the git based build timestamp provider. But then again it should not fail the build just because of that.<h2 id=solution>Solution</h2><p>But the solution to that was rather trivial. The <tt>jgit.ignore</tt> property follows the <a rel="noopener nofollow noreferrer" href=https://git-scm.com/docs/gitignore target=_blank>git ignore syntax</a> and also allows to specify directories:<pre class=language-xml data-lang=xml style=background:#fafafa;color:#383a42><code class=language-xml data-lang=xml><span><</span><span style=color:#e45649>jgit.ignore</span><span>>
</span><span>pom.xml
</span><span>target/
</span><span>&LT/</span><span style=color:#e45649>jgit.ignore</span><span>>
</span></code></pre><p>There are two things which have to be kept in mind: each entry goes to a new line, the root of the evaluation seems no the be the root of the project, so using “<tt>/target/</tt>” (compared to “<tt>target/</tt>“) does not work.</section></div></article></main><aside class="col-lg-3 order-first order-lg-0 sticky-top mt-lg-5 de-m-collapsible"><div class="de-sidebox de-m-right collapse d-lg-block" id=rightSidebox><div class="d-flex d-md-none pb-3"><div class=row><div class=col><a title="Link to my GitHub profile" class=link-secondary href=https://github.com/ctron target=_blank> <svg class="feather feather-github" viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg> </a></div><div class=col><a title="Link to my Mastodon profile" class=link-secondary href=https://mastodon.dentrassi.de/@ctron rel=me target=_blank> <svg viewbox="0 0 24 24" fill=currentColor height=24 stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M23.193 7.879c0-5.206-3.411-6.732-3.411-6.732C18.062.357 15.108.025 12.041 0h-.076c-3.068.025-6.02.357-7.74 1.147 0 0-3.411 1.526-3.411 6.732 0 1.192-.023 2.618.015 4.129.124 5.092.934 10.109 5.641 11.355 2.17.574 4.034.695 5.535.612 2.722-.15 4.25-.972 4.25-.972l-.09-1.975s-1.945.613-4.129.539c-2.165-.074-4.449-.233-4.799-2.891a5.499 5.499 0 0 1-.048-.745s2.125.52 4.817.643c1.646.075 3.19-.097 4.758-.283 3.007-.359 5.625-2.212 5.954-3.905.517-2.665.475-6.507.475-6.507zm-4.024 6.709h-2.497V8.469c0-1.29-.543-1.944-1.628-1.944-1.2 0-1.802.776-1.802 2.312v3.349h-2.483v-3.35c0-1.536-.602-2.312-1.802-2.312-1.085 0-1.628.655-1.628 1.944v6.119H4.832V8.284c0-1.289.328-2.313.987-3.07.68-.758 1.569-1.146 2.674-1.146 1.278 0 2.246.491 2.886 1.474L12 6.585l.622-1.043c.64-.983 1.608-1.474 2.886-1.474 1.104 0 1.994.388 2.674 1.146.658.757.986 1.781.986 3.07v6.304z"/></svg> </a></div><div class=col><a title="Link to my matrix address" class=link-secondary href=https://matrix.to/#%2F%40ctron%3Adentrassi.de target=_blank> <svg class="feather feather-message-square" viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg> </a></div></div></div><div class="de-c-toc mb-4"><h2>Table of Content</h2><ul class="list-unstyled de-c-toc__first" id=toc><li><a class=link-body-emphasis href=#the-background>The background</a><li><a class=link-body-emphasis href=#the-problem>The problem</a><li><a class=link-body-emphasis href=#solution>Solution</a></ul></div><div class="d-lg-block d-none"><div class="de-c-recent-posts mb-2"><h2 class=d-flex><span>Recent Posts</span> <span class=de-c-title__action> <a href=https://staging.dentrassi.de/archive>Archive</a> </span></h2><ul class=list-unstyled><li><a title="ReSyMo: Remote System Monitoring" class=link-body-emphasis href=/2024/04/07/remote-system-monitoring/>ReSyMo: Remote System Monitoring</a><li><a title="An OpenID Connect command line client" class=link-body-emphasis href=/2024/03/16/oidc-command-line-client/>An OpenID Connect command line client</a><li><a title="Release of Trunk 0.19.0" class=link-body-emphasis href=/2024/03/11/trunk-0-19-0/>Release of Trunk 0.19.0</a><li><a title="Good news everyone: Trunk is back" class=link-body-emphasis href=/2024/01/16/good-news-everyone/>Good news everyone: Trunk is back</a><li><a title="Yew components for OpenID connect and OAuth2" class=link-body-emphasis href=/2023/10/22/yew-oauth2/>Yew components for OpenID connect and OAuth2</a></ul></div></div><div class="de-c-toc mb-4"><h2 class=d-flex><span>Categories</span> <span class=de-c-title__action> <a href=https://staging.dentrassi.de/categories>All</a> </span></h2><ul class=list-unstyled><li><a class=link-body-emphasis href=https://staging.dentrassi.de/categories/development/>Development</a><li><a class=link-body-emphasis href=https://staging.dentrassi.de/categories/technical-stuff/>Technical Stuff</a></ul></div><div class="de-c-toc mb-4"><h2 class=d-flex><span>Tags</span> <span class=de-c-title__action> <a href=https://staging.dentrassi.de/tags>All</a> </span></h2><a class=link-body-emphasis href=https://staging.dentrassi.de/tags/java/>#java</a><span> </span><a class=link-body-emphasis href=https://staging.dentrassi.de/tags/maven/>#maven</a><span> </span><a class=link-body-emphasis href=https://staging.dentrassi.de/tags/osgi/>#osgi</a><span> </span><a class=link-body-emphasis href=https://staging.dentrassi.de/tags/tycho/>#tycho</a><span> </span></div></div></aside></div></div><footer class="bg-body-tertiary py-5 mt-lg-5"><div class="container text-body-secondary"><div class=row><div class="col-12 col-lg mb-2">© ctron's blog – All rights reserved</div><div class="col-12 col-lg"><ul class="list-unstyled mb-0"><li><a class=link-secondary href=https://staging.dentrassi.de/legal/disclaimer/>Disclaimer</a><li><a class=link-secondary href=https://staging.dentrassi.de/legal/impress/>Impressum / Impress</a><li><a class=link-secondary href=https://staging.dentrassi.de/legal/privacy/>Datenschutzerklärung / Privacy Policy</a></ul></div><div class="col-12 col-lg"><a class=link-secondary href=https://staging.dentrassi.de/legal/contact/>Contact</a></div></div></div></footer><script src="https://staging.dentrassi.de/js/bootstrap.bundle.min.js?h=0833b2e9c3a26c258476"></script><script src="https://staging.dentrassi.de/elasticlunr.min.js?h=4f648b9e42abdef9c436" defer></script><script src="https://staging.dentrassi.de/js/search.js?h=ed51a29cb343a0c8a535" defer></script><script>window.searchIndexLocation="https://staging.dentrassi.de/search_index.en.json?h=6453e4d67cfc60932d22"</script>