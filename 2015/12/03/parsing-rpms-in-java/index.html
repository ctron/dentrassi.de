<!doctype html><html lang=en-US><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><link as=font crossorigin href=https://dentrassi.de/files/jost-latin-400-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://dentrassi.de/files/jost-latin-500-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://dentrassi.de/files/jost-latin-700-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://dentrassi.de/files/noto-sans-latin-400-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://dentrassi.de/files/noto-sans-latin-500-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://dentrassi.de/files/noto-sans-latin-700-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://dentrassi.de/files/source-code-pro-latin-400-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://dentrassi.de/files/source-code-pro-latin-500-normal.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://dentrassi.de/files/source-code-pro-latin-700-normal.woff2 rel=preload type=font/woff2><link href="https://dentrassi.de/main.css?h=2dfc44bfb1473ee627f0" rel=stylesheet><meta content="The core idea of Package Drone is to extract meta data from files and generated some sort of repository index. And although Package Drone’s main focus is on OSGi, we did want to implement a YUM repository adapter and for this we needed to extract metadata from RPM files.
" name=description><meta content=article property=og:type><meta content="ctron's blog" property=og:site_name><meta content="Parsing RPMs in Java" property=og:title><meta content=https://dentrassi.de/2015/12/03/parsing-rpms-in-java property=og:url><meta content="The core idea of Package Drone is to extract meta data from files and generated some sort of repository index. And although Package Drone’s main focus is on OSGi, we did want to implement a YUM repository adapter and for this we needed to extract metadata from RPM files.
" property=og:description><meta content="Jens Reimann" property=og:author_name><meta content=https://dentrassi.de property=og:author_url><meta content=summary name=twitter:card><meta content=@ctron name=twitter:site><meta content="Parsing RPMs in Java" name=twitter:title><meta content="The core idea of Package Drone is to extract meta data from files and generated some sort of repository index. And although Package Drone’s main focus is on OSGi, we did want to implement a YUM repository adapter and for this we needed to extract metadata from RPM files.
" name=twitter:description><meta content=https://dentrassi.de/wp-content/uploads/RPM_Logo.svg_.png property=og:image><meta content=https://dentrassi.de/wp-content/uploads/RPM_Logo.svg_.png name=twitter:image><meta content=RPM name=twitter:image:alt><meta content=Eclipse property=article:tag><meta content="Package Drone" property=article:tag><meta content=RPM property=article:tag><title>Parsing RPMs in Java – ctron's blog</title><link href=https://dentrassi.de/2015/12/03/parsing-rpms-in-java/ rel=canonical><link href=https://dentrassi.de/rss.xml rel=alternate title=RSS type=application/rss+xml><script>var _paq=window._paq=window._paq||[];_paq.push(['trackPageView']);_paq.push(['enableLinkTracking']);(function(){var a="https://logs.dentrassi.de/";_paq.push(['setTrackerUrl',a+ 'matomo.php']);_paq.push(['setSiteId','1']);var b=document,c=b.createElement('script'),d=b.getElementsByTagName('script')[0];c.async=true;c.src=a+ 'matomo.js';d.parentNode.insertBefore(c,d)})()</script><body data-bs-spy=scroll data-bs-target=#toc tabindex=0><nav class="navbar fixed-top navbar-expand-lg bg-body-tertiary"><div class=container><a class=navbar-brand href=https://dentrassi.de>ctron's blog</a><form class="de-c-search-form d-none d-lg-flex ms-auto me-3"><input placeholder="Search docs" aria-label=Search autocomplete=off class=form-control id=searchInput type=search><div class="shadow bg-white rounded" id=suggestions></div></form><div class="d-none d-md-flex ms-auto ms-lg-0 me-4 me-lg-0"><div class=row><div class=col><a title="Link to my GitHub profile" class=link-secondary href=https://github.com/ctron target=_blank> <svg class="feather feather-github" viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg> </a></div><div class=col><a title="Link to my Mastodon profile" class=link-secondary href=https://mastodon.dentrassi.de/@ctron rel=me target=_blank> <svg viewbox="0 0 24 24" fill=currentColor height=24 stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M23.193 7.879c0-5.206-3.411-6.732-3.411-6.732C18.062.357 15.108.025 12.041 0h-.076c-3.068.025-6.02.357-7.74 1.147 0 0-3.411 1.526-3.411 6.732 0 1.192-.023 2.618.015 4.129.124 5.092.934 10.109 5.641 11.355 2.17.574 4.034.695 5.535.612 2.722-.15 4.25-.972 4.25-.972l-.09-1.975s-1.945.613-4.129.539c-2.165-.074-4.449-.233-4.799-2.891a5.499 5.499 0 0 1-.048-.745s2.125.52 4.817.643c1.646.075 3.19-.097 4.758-.283 3.007-.359 5.625-2.212 5.954-3.905.517-2.665.475-6.507.475-6.507zm-4.024 6.709h-2.497V8.469c0-1.29-.543-1.944-1.628-1.944-1.2 0-1.802.776-1.802 2.312v3.349h-2.483v-3.35c0-1.536-.602-2.312-1.802-2.312-1.085 0-1.628.655-1.628 1.944v6.119H4.832V8.284c0-1.289.328-2.313.987-3.07.68-.758 1.569-1.146 2.674-1.146 1.278 0 2.246.491 2.886 1.474L12 6.585l.622-1.043c.64-.983 1.608-1.474 2.886-1.474 1.104 0 1.994.388 2.674 1.146.658.757.986 1.781.986 3.07v6.304z"/></svg> </a></div><div class=col><a title="Link to my matrix address" class=link-secondary href=https://matrix.to/#%2F%40ctron%3Adentrassi.de target=_blank> <svg class="feather feather-message-square" viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg> </a></div></div></div><button aria-label="Toggle navigation" aria-controls=rightSidebox aria-expanded=false class=navbar-toggler data-bs-target=#rightSidebox data-bs-toggle=collapse type=button><span class=navbar-toggler-icon></span></button></div></nav><div class="de-layout container"><div class="row d-flex align-items-start"><aside class="col-lg-2 order-last order-lg-0 sticky-lg-top mt-4 mt-lg-5"><div class="de-sidebox de-m-left"><div class=mb-4><h2>More</h2><ul class=list-unstyled><li><a class=link-body-emphasis href=/pages/about/>About</a><li><a class=link-body-emphasis href=/pages/pgp-key/>PGP Key</a><li><a class=link-body-emphasis href=/pages/attic/>Attic</a></ul></div><div class=mb-4><h2>Projects</h2><ul class=list-unstyled><li><a class=link-body-emphasis href=/projects/patternfly-yew/>PatternFly Yew</a><li><a class=link-body-emphasis href=/projects/yew-oauth2/>Yew OAuth2</a><li><a class=link-body-emphasis href=/projects/rpm-builder/>Maven RPM Builder</a><li><a class=link-body-emphasis href=/projects/drogue-iot/>Drogue IoT</a><li><a class=link-body-emphasis href=/projects/openshift-update-graph/>OpenShift Update Graph</a><li><a class=link-body-emphasis href=/projects/ecliipse-iot-packages/>Eclipse IoT Packages</a></ul></div></div></aside><main class="col-12 col-lg-7 px-lg-5 mt-3 mt-lg-4"><article class=de-article itemscope itemtype=http://schema.org/BlogPosting><div><section class=de-article__header><h1 itemprop=headline>Parsing RPMs in Java</h1><div><div class="de-c-post-meta text-muted"><ul class=list-inline><li class=list-inline-item><span>4 minute read</span> <meta content=733 itemprop=wordCount> <span class=d-none itemprop=author itemscope itemtype=https://schema.org/Person> <a href=https://dentrassi.de itemprop=url> <span itemprop=name>Jens Reimann</span> </a> </span><li class=list-inline-item><span content=2015-12-03T21:36:52+01:00 itemprop=datePublished> 3 December 2015</span><li class=list-inline-item><span><a class=link-secondary href=/categories/development>Development</a></span></ul><ul class=list-inline><li class=list-inline-item><a class=link-secondary href=https://dentrassi.de/tags/eclipse/>#eclipse</a> <a class=link-secondary href=https://dentrassi.de/tags/package-drone/>#package drone</a> <a class=link-secondary href=https://dentrassi.de/tags/rpm/>#rpm</a></ul></div></div></section><hr><section class=de-article__body itemprop=articleBody><img alt=RPM class=de-c-article-image itemprop=image src=https://dentrassi.de/wp-content/uploads/RPM_Logo.svg_.png><p>The core idea of <a rel="noopener nofollow noreferrer" href=http://packagedrone.org target=_blank>Package Drone</a> is to extract meta data from files and generated some sort of repository index. And although Package Drone’s main focus is on OSGi, we did want to implement a YUM repository adapter and for this we needed to extract metadata from RPM files.</p><span id=continue-reading></span><p>Package Drone itself is written in Java. So I wanted some sort of Java approach. Of course it would be possible to run the <code>rpm</code> command in the background, parse the output somehow and gather the meta data information from that. Or make a JNI wrapper to <code>librpm</code> and extract the information with a native library call. However this is not only prone to error, but also a nightmare when it comes to porting.<p>So I really was looking for a plain Java solution, which also was compatible with the license of Eclipse (EPL). I came across <a rel="noopener nofollow noreferrer" href=http://jrpm.sourceforge.net/ target=_blank>jRPM</a> and <a rel="noopener nofollow noreferrer" href=https://github.com/craigwblake/redline target=_blank>redline</a>.<p>jRPM was last updated around 2005, still has an Apache 1.1 license and simply stuck in the past. redline is more up to date and sounded promising at first, but then the library is really more like a jar file with some “main” entry points and an ant task. There is no clear API for programmatically reading the RPM files. And the legal aspect was a little bit troublesome to me. 28 contributors according to GitHub, no CLA, an “MIT license” from a company simple named “FreeCompany” and the Google Tracking code backed right into the Maven POM file. So, I had to do it myself ;-)<h2 id=a-fresh-start>A fresh start</h2><p>So not to fall into the same pitfalls, I did start to write a parsing library first, instead of directly writing the Package Drone extractor module. This way there is now a clean library which can parse RPM files. It also is an OSGi bundle, which was necessary for Package Drone, but does not make use of any OSGi functionality. So it still can be used as a simple JAR file. Licensed under the EPL, as requirement for Eclipse projects anyway and the Eclipse CLA and IP process to take care of the legal aspects. And if you are an Eclipse project, you even don’t need a CQ to use it.<h2 id=what-s-the-catch>What’s the catch?</h2><p>I did implement what I needed. And that was reading RPM metadata and building a YUM repository index. So writing RPM files or reading/writing signatures is not possible at the moment. However there are plans to sign YUM repositories and RPM files as well. So this limitation is only a matter of time. Also are there some fields which are not mapped to enums. RPM used numeric IDs internally, many are mapped, but not all. You can still access those, but by number not by enum in that case.<p>Also is this library currently not on maven central. But again, I am also working an a “deploy to Maven Central” feature in Package Drone, which will clear that blocker.<h2 id=so-where-are-we-now>So where are we now?</h2><p>So the code is <a rel="noopener nofollow noreferrer" href=https://github.com/eclipse/packagedrone/tree/master/bundles/org.eclipse.packagedrone.utils.rpm target=_blank>right here</a> on GitHub. In a few weeks we will have a binary download, but right now the Eclipse IP process has to clear the way first.<p>Looking at the <a rel="noopener nofollow noreferrer" href=https://github.com/eclipse/packagedrone/blob/master/bundles/org.eclipse.packagedrone.utils.rpm.tests/src/org/eclipse/packagedrone/utils/rpm/tests/InputStreamTest.java target=_blank>source code of the test case</a> you can see how this library works. Instead of working on a plain <a rel="noopener nofollow noreferrer" href=https://docs.oracle.com/javase/8/docs/api/java/io/File.html target=_blank>File</a>, it can work on an <a rel="noopener nofollow noreferrer" href=https://docs.oracle.com/javase/8/docs/api/java/io/InputStream.html target=_blank>InputStream</a>, which can be important if your RPM file comes from a remote location.<p>The following example shows how to extract metadata and content from an RPM file.<pre class=language-java data-lang=java style=background:#fafafa;color:#383a42><code class=language-java data-lang=java><span style=color:#a626a4>try</span><span>(</span><span style=color:#c18401>RpmInputStream</span><span> in </span><span style=color:#a626a4>= new </span><span style=color:#c18401>RpmInputStream</span><span>(</span><span style=color:#a626a4>new </span><span style=color:#c18401>FileInputStream</span><span>(</span><span style=color:#50a14f>"file.rpm"</span><span>))) {  
</span><span> </span><span style=color:#c18401>String</span><span> name </span><span style=color:#a626a4>= </span><span>(</span><span style=color:#c18401>String</span><span>)in.</span><span style=color:#e45649>getPayloadHeader </span><span>().</span><span style=color:#e45649>getTag </span><span>(</span><span style=color:#c18401>RpmTag</span><span>.</span><span style=color:#c18401>NAME</span><span>);
</span><span>
</span><span> </span><span style=color:#c18401>CpioArchiveInputStream</span><span> cpio </span><span style=color:#a626a4>=</span><span> in.</span><span style=color:#e45649>getCpioStream </span><span>();
</span><span> </span><span style=color:#c18401>CpioArchiveEntry</span><span> entry;
</span><span> </span><span style=color:#a626a4>while </span><span>((entry </span><span style=color:#a626a4>=</span><span> cpio.</span><span style=color:#e45649>getNextCPIOEntry </span><span>()) </span><span style=color:#a626a4>!= </span><span style=color:#c18401>null</span><span>) {
</span><span>   </span><span style=color:#e45649>process </span><span>( entry );  
</span><span> }
</span><span>}
</span></code></pre><p>There is also the <a rel="noopener nofollow noreferrer" href=http://doc.packagedrone.org/javadoc/de/dentrassi/rpm/package-summary.html target=_blank>older JavaDoc</a>, which has to be updated to reflect the change to <code>org.eclipse.packagedrone</code>.<h2 id=what-s-next>What’s next?</h2><p>Of course a binary release at Eclipse, an updated JavaDoc and publishing the binaries to Maven Central. Beside extending the library to be able to sign and write RPM files.<p>If you like to help or need some help using it, just let me know!</section></div></article></main><aside class="col-lg-3 order-first order-lg-0 sticky-top mt-lg-5 de-m-collapsible"><div class="de-sidebox de-m-right collapse d-lg-block" id=rightSidebox><div class="d-flex d-md-none pb-3"><div class=row><div class=col><a title="Link to my GitHub profile" class=link-secondary href=https://github.com/ctron target=_blank> <svg class="feather feather-github" viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg> </a></div><div class=col><a title="Link to my Mastodon profile" class=link-secondary href=https://mastodon.dentrassi.de/@ctron rel=me target=_blank> <svg viewbox="0 0 24 24" fill=currentColor height=24 stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M23.193 7.879c0-5.206-3.411-6.732-3.411-6.732C18.062.357 15.108.025 12.041 0h-.076c-3.068.025-6.02.357-7.74 1.147 0 0-3.411 1.526-3.411 6.732 0 1.192-.023 2.618.015 4.129.124 5.092.934 10.109 5.641 11.355 2.17.574 4.034.695 5.535.612 2.722-.15 4.25-.972 4.25-.972l-.09-1.975s-1.945.613-4.129.539c-2.165-.074-4.449-.233-4.799-2.891a5.499 5.499 0 0 1-.048-.745s2.125.52 4.817.643c1.646.075 3.19-.097 4.758-.283 3.007-.359 5.625-2.212 5.954-3.905.517-2.665.475-6.507.475-6.507zm-4.024 6.709h-2.497V8.469c0-1.29-.543-1.944-1.628-1.944-1.2 0-1.802.776-1.802 2.312v3.349h-2.483v-3.35c0-1.536-.602-2.312-1.802-2.312-1.085 0-1.628.655-1.628 1.944v6.119H4.832V8.284c0-1.289.328-2.313.987-3.07.68-.758 1.569-1.146 2.674-1.146 1.278 0 2.246.491 2.886 1.474L12 6.585l.622-1.043c.64-.983 1.608-1.474 2.886-1.474 1.104 0 1.994.388 2.674 1.146.658.757.986 1.781.986 3.07v6.304z"/></svg> </a></div><div class=col><a title="Link to my matrix address" class=link-secondary href=https://matrix.to/#%2F%40ctron%3Adentrassi.de target=_blank> <svg class="feather feather-message-square" viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg> </a></div></div></div><div class="de-c-toc mb-4"><h2>Table of Content</h2><ul class="list-unstyled de-c-toc__first" id=toc><li><a class=link-body-emphasis href=#a-fresh-start>A fresh start</a><li><a class=link-body-emphasis href=#what-s-the-catch>What’s the catch?</a><li><a class=link-body-emphasis href=#so-where-are-we-now>So where are we now?</a><li><a class=link-body-emphasis href=#what-s-next>What’s next?</a></ul></div><div class="d-lg-block d-none"><div class="de-c-recent-posts mb-2"><h2 class=d-flex><span>Recent Posts</span> <span class=de-c-title__action> <a href=https://dentrassi.de/archive>Archive</a> </span></h2><ul class=list-unstyled><li><a title="ReSyMo: Remote System Monitoring" class=link-body-emphasis href=/2024/04/07/remote-system-monitoring/>ReSyMo: Remote System Monitoring</a><li><a title="An OpenID Connect command line client" class=link-body-emphasis href=/2024/03/16/oidc-command-line-client/>An OpenID Connect command line client</a><li><a title="Release of Trunk 0.19.0" class=link-body-emphasis href=/2024/03/11/trunk-0-19-0/>Release of Trunk 0.19.0</a><li><a title="Good news everyone: Trunk is back" class=link-body-emphasis href=/2024/01/16/good-news-everyone/>Good news everyone: Trunk is back</a><li><a title="Yew components for OpenID connect and OAuth2" class=link-body-emphasis href=/2023/10/22/yew-oauth2/>Yew components for OpenID connect and OAuth2</a></ul></div></div><div class="de-c-toc mb-4"><h2 class=d-flex><span>Categories</span> <span class=de-c-title__action> <a href=https://dentrassi.de/categories>All</a> </span></h2><ul class=list-unstyled><li><a class=link-body-emphasis href=https://dentrassi.de/categories/development/>Development</a><li><a class=link-body-emphasis href=https://dentrassi.de/categories/technical-stuff/>Technical Stuff</a></ul></div><div class="de-c-toc mb-4"><h2 class=d-flex><span>Tags</span> <span class=de-c-title__action> <a href=https://dentrassi.de/tags>All</a> </span></h2><a class=link-body-emphasis href=https://dentrassi.de/tags/eclipse/>#eclipse</a><a class=link-body-emphasis href=https://dentrassi.de/tags/package-drone/>#package drone</a><a class=link-body-emphasis href=https://dentrassi.de/tags/rpm/>#rpm</a></div></div></aside></div></div><footer class="bg-body-tertiary py-5 mt-lg-5"><div class="container text-body-secondary"><div class=row><div class="col-12 col-lg mb-2">© ctron's blog – All rights reserved</div><div class="col-12 col-lg"><ul class="list-unstyled mb-0"><li><a class=link-secondary href=https://dentrassi.de/legal/disclaimer/>Disclaimer</a><li><a class=link-secondary href=https://dentrassi.de/legal/impress/>Impressum / Impress</a><li><a class=link-secondary href=https://dentrassi.de/legal/privacy/>Datenschutzerklärung / Privacy Policy</a></ul></div><div class="col-12 col-lg"><a class=link-secondary href=https://dentrassi.de/legal/contact/>Contact</a></div></div></div></footer><script src="https://dentrassi.de/js/bootstrap.bundle.min.js?h=0833b2e9c3a26c258476"></script><script src="https://dentrassi.de/elasticlunr.min.js?h=4f648b9e42abdef9c436" defer></script><script src="https://dentrassi.de/js/search.js?h=ed51a29cb343a0c8a535" defer></script><script>window.searchIndexLocation="https://dentrassi.de/search_index.en.json?h=e3e6b11e7cd210e31d32"</script>